
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Getting started with Connector API</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>

    <link href="images/favicon.ico" rel="icon" type="image/ico" />
  </head>

  <body class="index" data-languages="[&quot;shell&quot;,&quot;java&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="shell">shell</a>
              <a href="#" data-language-name="java">java</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#use-cases" class="toc-h2 toc-link" data-title="Use Cases">Use Cases</a>
                  </li>
                  <li>
                    <a href="#about-messaging" class="toc-h2 toc-link" data-title="About Messaging">About Messaging</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#prerequisites" class="toc-h1 toc-link" data-title="Prerequisites">Prerequisites</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#install-an-application" class="toc-h2 toc-link" data-title="Install an application">Install an application</a>
                  </li>
                  <li>
                    <a href="#modify-the-endpoint-urls" class="toc-h2 toc-link" data-title="Modify the endpoint URLs">Modify the endpoint URLs</a>
                  </li>
                  <li>
                    <a href="#required-and-optional-apis" class="toc-h2 toc-link" data-title="Required and optional APIs">Required and optional APIs</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#authentication" class="toc-h1 toc-link" data-title="Authentication">Authentication</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#request-a-jwt" class="toc-h2 toc-link" data-title="Request a JWT">Request a JWT</a>
                  </li>
                  <li>
                    <a href="#jwt-expiration" class="toc-h2 toc-link" data-title="JWT expiration">JWT expiration</a>
                  </li>
                  <li>
                    <a href="#use-a-jwt" class="toc-h2 toc-link" data-title="Use a JWT">Use a JWT</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#consumer-identity" class="toc-h1 toc-link" data-title="Consumer identity">Consumer identity</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#retrieve-a-jws" class="toc-h2 toc-link" data-title="Retrieve a JWS">Retrieve a JWS</a>
                  </li>
                  <li>
                    <a href="#request-2" class="toc-h2 toc-link" data-title="Request">Request</a>
                  </li>
                  <li>
                    <a href="#response-2" class="toc-h2 toc-link" data-title="Response">Response</a>
                  </li>
                  <li>
                    <a href="#use-the-jws" class="toc-h2 toc-link" data-title="Use the JWS">Use the JWS</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#conversation" class="toc-h1 toc-link" data-title="Conversation">Conversation</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#create-a-conversation" class="toc-h2 toc-link" data-title="Create a conversation">Create a conversation</a>
                  </li>
                  <li>
                    <a href="#create-a-conversation-with-skill-routing" class="toc-h2 toc-link" data-title="Create a conversation with skill routing">Create a conversation with skill routing</a>
                  </li>
                  <li>
                    <a href="#close-conversation" class="toc-h2 toc-link" data-title="Close conversation">Close conversation</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#send-a-message" class="toc-h1 toc-link" data-title="Send a message">Send a message</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#request-5" class="toc-h2 toc-link" data-title="Request">Request</a>
                  </li>
                  <li>
                    <a href="#https-headers-3" class="toc-h2 toc-link" data-title="HTTPS headers">HTTPS headers</a>
                  </li>
                  <li>
                    <a href="#payload-3" class="toc-h2 toc-link" data-title="Payload">Payload</a>
                  </li>
                  <li>
                    <a href="#response-5" class="toc-h2 toc-link" data-title="Response">Response</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#webhooks" class="toc-h1 toc-link" data-title="Webhooks">Webhooks</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#requirements" class="toc-h2 toc-link" data-title="Requirements">Requirements</a>
                  </li>
                  <li>
                    <a href="#authentication-2" class="toc-h2 toc-link" data-title="Authentication">Authentication</a>
                  </li>
                  <li>
                    <a href="#notification-types" class="toc-h2 toc-link" data-title="Notification types">Notification types</a>
                  </li>
                  <li>
                    <a href="#conversation-created" class="toc-h2 toc-link" data-title="Conversation created">Conversation created</a>
                  </li>
                  <li>
                    <a href="#agent-joined" class="toc-h2 toc-link" data-title="Agent joined">Agent joined</a>
                  </li>
                  <li>
                    <a href="#message-by-agent" class="toc-h2 toc-link" data-title="Message by agent">Message by agent</a>
                  </li>
                  <li>
                    <a href="#skill-transfer" class="toc-h2 toc-link" data-title="Skill transfer">Skill transfer</a>
                  </li>
                  <li>
                    <a href="#conversation-closed-by-agent" class="toc-h2 toc-link" data-title="Conversation closed by agent">Conversation closed by agent</a>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='https://developers.liveperson.com'>LivePerson Developer Portal</a></li>
            <li><a href='https://knowledge.liveperson.com'>LivePerson Knowledge Center</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>Messaging connects your customers with human agents or bots. A key component is enabling conversations across Messaging apps&mdash;go where your customers are. As part of LivePerson&#39;s open platform we provide a growing number of out-of-the-box connectors, e.g., for SMS <a href="https://developers.liveperson.com/sms-with-liveengage-overview.html"><i class="fas fa-external-link-alt" style="color:darkgray;"></i></a>, Facebook Messenger, WhatsApp, and others. In cases where an out-of-the-box solution is not available you can use LivePerson&#39;s APIs to build a custom connector.</p>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h2 id='use-cases'>Use Cases</h2>
<p>A common use case for building your own connector to LiveEngage Messaging is SMS integration. LivePerson offers a SMS Twilio connector out-of-the-box, which is an excellent solution for most use cases. However, there are other cases where you want to use another SMS Gateway or similar:</p>

<ul>
<li>Integrate a custom SMS gateway.</li>
<li>Integrate a proprietray chat window.</li>
<li>Integrate a mobile application when the LivePerson Mobile SDK is not applicable. </li>
</ul>

<p>Connectors are <strong>server applications</strong>. If you are planning to build a client-side application, please refer to the Messaging Window API <a href="https://developers.liveperson.com/messaging-window-api-overview.html"><i class="fas fa-external-link-alt" style="color:darkgray;"></i></a>.</p>

<aside class="success">
If you are not sure about developing a connector, please contact your account team to discuss the best solution fit for your use case!
</aside>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h2 id='about-messaging'>About Messaging</h2>
<p>Messaging is centered around <span class="TooltipTrigger" data-tooltips="A conversation is an interactive communication between customer and  agent/bot. Its participants are exchanging text messages or other media. Messaging conversations are asynchronous by default. Synchronous interactions such as voice and video interactions are supported as well." data-position="OnBottom">conversations</span>. When a customer first connects to LiveEngage, they will do so by creating a conversation. A new conversation is assigned to an agent or bot. Not every Messaging app has a notion of conversation&mdash;in the case of SMS messages are of exchanged in a sequence. </p>

<p>Conversations can be created or closed, and each customer can only have one open conversation at a time. Agents and bots, on the other hand, can respond to multiple conversations. A conversation is closed when it ends, e.g., the agent has resolved the case and closes the conversation. There are also cases when a conversation is closed automatically, for example, when a customer is no longer responding (&#39;auto close&#39;). Conversations can be split into dialogs of different types. The &#39;main&#39; dialog is the one that holds the actual messaging exchange, however, depending on the application there could be more dialog types such as CoBrowse or Survey.</p>

<p>Customers, agents, agent managers, or bots are all identifiable participants in a conversation. Often customers are not only introduced using an ID but carry additional information, such as name and contact data. This information is sent by using 
 <span class="TooltipTrigger" data-tooltips="Engagement Attributes are specific customer information such as product viewed, purchase information, errors the visitor encountered, and search results. They can be collected before or during a conversation. Engagement Attributes are also referred to as SDEs (Standard Data Entity)" data-position="OnBottom">Engagement Attributes</span>.</p>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h1 id='prerequisites'>Prerequisites</h1><h2 id='install-an-application'>Install an application</h2>
<blockquote>
<p>Manifest example (JSON):</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="o">{</span>
  <span class="s2">"client_name"</span>: <span class="s2">"App name"</span>,
  <span class="s2">"description"</span>: <span class="s2">"App description"</span>,
  <span class="s2">"grant_types"</span>: <span class="o">[</span>
    <span class="s2">"client_credentials"</span>
  <span class="o">]</span>,
  <span class="s2">"scope"</span>: <span class="s2">"msg.consumer"</span>,
  <span class="s2">"capabilities"</span>: <span class="o">{</span>
    <span class="s2">"webhooks"</span>: <span class="o">{</span>
      <span class="s2">"ms.MessagingEventNotification.ContentEvent"</span>: <span class="o">{</span>
        <span class="s2">"endpoint"</span>: <span class="s2">"https://your/webhooks/endpoint"</span>,
        <span class="s2">"max_retries"</span>: 5
      <span class="o">}</span>,
      <span class="s2">"ms.MessagingEventNotification.RichContentEvent"</span>: <span class="o">{</span>
        <span class="s2">"endpoint"</span>: <span class="s2">"https://your/webhooks/endpoint"</span>,
        <span class="s2">"max_retries"</span>: 5
      <span class="o">}</span>,
      <span class="s2">"ms.MessagingEventNotification.AcceptStatusEvent"</span>: <span class="o">{</span>
        <span class="s2">"endpoint"</span>: <span class="s2">"https://your/webhooks/endpoint"</span>,
        <span class="s2">"max_retries"</span>: 5
      <span class="o">}</span>,
      <span class="s2">"ms.MessagingEventNotification.ChatStateEvent"</span>: <span class="o">{</span>
        <span class="s2">"endpoint"</span>: <span class="s2">"https://your/webhooks/endpoint"</span>,
        <span class="s2">"max_retries"</span>: 5
      <span class="o">}</span>,
      <span class="s2">"cqm.ExConversationChangeNotification"</span>: <span class="o">{</span>
        <span class="s2">"endpoint"</span>: <span class="s2">"https://your/webhooks/endpoint"</span>,
        <span class="s2">"max_retries"</span>: 5
      <span class="o">}</span>
    <span class="o">}</span>,
    <span class="s2">"engagement"</span>: <span class="o">{</span>
      <span class="s2">"design_engagement"</span>: <span class="nb">false</span>,
      <span class="s2">"design_window"</span>: <span class="nb">false</span>,
      <span class="s2">"entry_point"</span>: <span class="o">[</span>
        <span class="s2">"section"</span>
      <span class="o">]</span>,
      <span class="s2">"visitor_behavior"</span>: <span class="o">[</span>
        <span class="s2">"visited_location"</span>,
        <span class="s2">"time_on_location"</span>,
        <span class="s2">"flow"</span>,
        <span class="s2">"engaged_in_session"</span>,
        <span class="s2">"about_to_abandon"</span>,
        <span class="s2">"cart_value"</span>,
        <span class="s2">"cart_items"</span>,
        <span class="s2">"visitor_error"</span>,
        <span class="s2">"viewed_products"</span>,
        <span class="s2">"service_activity"</span>
      <span class="o">]</span>,
      <span class="s2">"target_audience"</span>: <span class="o">[</span>
        <span class="s2">"external_referral"</span>,
        <span class="s2">"search_keywords"</span>,
        <span class="s2">"ip"</span>,
        <span class="s2">"platform"</span>,
        <span class="s2">"geo_location"</span>,
        <span class="s2">"returning_visitors"</span>,
        <span class="s2">"marketing_source"</span>,
        <span class="s2">"customer_type"</span>,
        <span class="s2">"age"</span>,
        <span class="s2">"balance"</span>,
        <span class="s2">"customer_id"</span>,
        <span class="s2">"gender"</span>,
        <span class="s2">"store_zip_code"</span>,
        <span class="s2">"store_number"</span>,
        <span class="s2">"company_size"</span>,
        <span class="s2">"registration_date"</span>
      <span class="o">]</span>,
      <span class="s2">"goal"</span>: <span class="o">[</span>
        <span class="s2">"url"</span>,
        <span class="s2">"purchase_total"</span>,
        <span class="s2">"num_of_pages"</span>,
        <span class="s2">"lead"</span>,
        <span class="s2">"service_activity"</span>
      <span class="o">]</span>,
      <span class="s2">"consumer_identity"</span>: <span class="o">[</span>
        <span class="s2">"auth"</span>
      <span class="o">]</span>,
      <span class="s2">"language_selection"</span>: <span class="nb">false</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="o">{</span>
  <span class="s">"client_name"</span><span class="o">:</span> <span class="s">"App name"</span><span class="o">,</span>
  <span class="s">"description"</span><span class="o">:</span> <span class="s">"App description"</span><span class="o">,</span>
  <span class="s">"grant_types"</span><span class="o">:</span> <span class="o">[</span>
    <span class="s">"client_credentials"</span>
  <span class="o">],</span>
  <span class="s">"scope"</span><span class="o">:</span> <span class="s">"msg.consumer"</span><span class="o">,</span>
  <span class="s">"capabilities"</span><span class="o">:</span> <span class="o">{</span>
    <span class="s">"webhooks"</span><span class="o">:</span> <span class="o">{</span>
      <span class="s">"ms.MessagingEventNotification.ContentEvent"</span><span class="o">:</span> <span class="o">{</span>
        <span class="s">"endpoint"</span><span class="o">:</span> <span class="s">"https://your/webhooks/endpoint"</span><span class="o">,</span>
        <span class="s">"max_retries"</span><span class="o">:</span> <span class="mi">5</span>
      <span class="o">},</span>
      <span class="s">"ms.MessagingEventNotification.RichContentEvent"</span><span class="o">:</span> <span class="o">{</span>
        <span class="s">"endpoint"</span><span class="o">:</span> <span class="s">"https://your/webhooks/endpoint"</span><span class="o">,</span>
        <span class="s">"max_retries"</span><span class="o">:</span> <span class="mi">5</span>
      <span class="o">},</span>
      <span class="s">"ms.MessagingEventNotification.AcceptStatusEvent"</span><span class="o">:</span> <span class="o">{</span>
        <span class="s">"endpoint"</span><span class="o">:</span> <span class="s">"https://your/webhooks/endpoint"</span><span class="o">,</span>
        <span class="s">"max_retries"</span><span class="o">:</span> <span class="mi">5</span>
      <span class="o">},</span>
      <span class="s">"ms.MessagingEventNotification.ChatStateEvent"</span><span class="o">:</span> <span class="o">{</span>
        <span class="s">"endpoint"</span><span class="o">:</span> <span class="s">"https://your/webhooks/endpoint"</span><span class="o">,</span>
        <span class="s">"max_retries"</span><span class="o">:</span> <span class="mi">5</span>
      <span class="o">},</span>
      <span class="s">"cqm.ExConversationChangeNotification"</span><span class="o">:</span> <span class="o">{</span>
        <span class="s">"endpoint"</span><span class="o">:</span> <span class="s">"https://your/webhooks/endpoint"</span><span class="o">,</span>
        <span class="s">"max_retries"</span><span class="o">:</span> <span class="mi">5</span>
      <span class="o">}</span>
    <span class="o">},</span>
    <span class="s">"engagement"</span><span class="o">:</span> <span class="o">{</span>
      <span class="s">"design_engagement"</span><span class="o">:</span> <span class="kc">false</span><span class="o">,</span>
      <span class="s">"design_window"</span><span class="o">:</span> <span class="kc">false</span><span class="o">,</span>
      <span class="s">"entry_point"</span><span class="o">:</span> <span class="o">[</span>
        <span class="s">"section"</span>
      <span class="o">],</span>
      <span class="s">"visitor_behavior"</span><span class="o">:</span> <span class="o">[</span>
        <span class="s">"visited_location"</span><span class="o">,</span>
        <span class="s">"time_on_location"</span><span class="o">,</span>
        <span class="s">"flow"</span><span class="o">,</span>
        <span class="s">"engaged_in_session"</span><span class="o">,</span>
        <span class="s">"about_to_abandon"</span><span class="o">,</span>
        <span class="s">"cart_value"</span><span class="o">,</span>
        <span class="s">"cart_items"</span><span class="o">,</span>
        <span class="s">"visitor_error"</span><span class="o">,</span>
        <span class="s">"viewed_products"</span><span class="o">,</span>
        <span class="s">"service_activity"</span>
      <span class="o">],</span>
      <span class="s">"target_audience"</span><span class="o">:</span> <span class="o">[</span>
        <span class="s">"external_referral"</span><span class="o">,</span>
        <span class="s">"search_keywords"</span><span class="o">,</span>
        <span class="s">"ip"</span><span class="o">,</span>
        <span class="s">"platform"</span><span class="o">,</span>
        <span class="s">"geo_location"</span><span class="o">,</span>
        <span class="s">"returning_visitors"</span><span class="o">,</span>
        <span class="s">"marketing_source"</span><span class="o">,</span>
        <span class="s">"customer_type"</span><span class="o">,</span>
        <span class="s">"age"</span><span class="o">,</span>
        <span class="s">"balance"</span><span class="o">,</span>
        <span class="s">"customer_id"</span><span class="o">,</span>
        <span class="s">"gender"</span><span class="o">,</span>
        <span class="s">"store_zip_code"</span><span class="o">,</span>
        <span class="s">"store_number"</span><span class="o">,</span>
        <span class="s">"company_size"</span><span class="o">,</span>
        <span class="s">"registration_date"</span>
      <span class="o">],</span>
      <span class="s">"goal"</span><span class="o">:</span> <span class="o">[</span>
        <span class="s">"url"</span><span class="o">,</span>
        <span class="s">"purchase_total"</span><span class="o">,</span>
        <span class="s">"num_of_pages"</span><span class="o">,</span>
        <span class="s">"lead"</span><span class="o">,</span>
        <span class="s">"service_activity"</span>
      <span class="o">],</span>
      <span class="s">"consumer_identity"</span><span class="o">:</span> <span class="o">[</span>
        <span class="s">"auth"</span>
      <span class="o">],</span>
      <span class="s">"language_selection"</span><span class="o">:</span> <span class="kc">false</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>The Connector API uses JSON Web Tokens (JWT) allow access to the API. The JWTs are requested using obtain <code>clientId</code> and <code>clientSecret</code>. In order to obtain these intitially you have to register a new LiveEngage application.</p>

<aside class="warning">
Please reach out to your account team for first-time installation. Stay tuned for self-service installation in the near future!
</aside>

<p>Your application is installed using a manifest specified in JSON. An example manifest is shown on the right. The following attibutes should be defined:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Mandatory</th>
</tr>
</thead><tbody>
<tr>
<td>client_name</td>
<td>Name of your connector application</td>
<td>Yes</td>
</tr>
<tr>
<td>description</td>
<td>Client secret of your installed application</td>
<td>No</td>
</tr>
<tr>
<td>webhook</td>
<td>Defines the webhook configuration of your application</td>
<td>Yes</td>
</tr>
<tr>
<td>endpoint</td>
<td>Defines the URL of your webhook endpoint. Must start with HTTPS.</td>
<td>Yes. The notification types are optional.</td>
</tr>
<tr>
<td>max_retries</td>
<td>Number of retries if a notification cannot be delivered to your Webhook endpoint. Max = 5.</td>
<td>No</td>
</tr>
<tr>
<td>engagement</td>
<td>Defines an engagement for your application that will later be used in a campaign</td>
<td>Recommended for reporting</td>
</tr>
</tbody></table>

<aside class="success">
The parameter `client_name` will be visible to the agent as the source of the conversation in the Consumer Info widget.
</aside>

<p>After filling in the JSON Template with the required data, please contact your Account Management team to register your connector application.</p>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h3 id='result'>Result</h3>
<p>If the application installation is successful you will receive the client id token and the client secret token, which is confidential:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>client_id</td>
<td>Client id obtained of your installed application.</td>
</tr>
<tr>
<td>client_secret</td>
<td>Client secret of your installed application.</td>
</tr>
</tbody></table>
<h2 id='modify-the-endpoint-urls'>Modify the endpoint URLs</h2>
<p>Once the inital application manifest has been deployed and you have <code>client_id</code> and <code>client_secret</code> you can login to the Demo Connector <a href="https://connector-api.dev.liveperson.net/"><i class="fas fa-external-link-alt" style="color:darkgray;"></i></a> with admin privileges and change the URLs of your webhook endpoints. </p>

<aside class="success">
The demo connector requires admin privileges to change a Webhook configuration.
</aside>
<h2 id='required-and-optional-apis'>Required and optional APIs</h2>
<p>Implementing a custom connector requires several LivePerson APIs&mdash;depending on functional scope of your server application. Most of the required functionality is covered by Connector API, which is responsible for receiving and sending messages. Consumer messages are encoded as JSON and sent via HTTPS. If an agent or bot answers a notification is sent to your configured Webhook endpoint.</p>

<aside class="info">
In the remainder of this tutorial, the LivePerson APIs listed below will be introduced by example. In order to learn more about the APIs click on the links in the table to see the developer documentation.
</aside>

<table><thead>
<tr>
<th>LivePerson API</th>
<th>Description</th>
<th>Link</th>
</tr>
</thead><tbody>
<tr>
<td>Connector API</td>
<td>Send and receive messages on behalf of consumers</td>
<td><a href="https://developers.liveperson.com/connector-api-first-steps-overview.html"><i class="fas fa-external-link-alt" style="color:darkgray;"></i></a></td>
</tr>
<tr>
<td>Domain API</td>
<td>Retrieve domains for API services, e.g., authentication</td>
<td><a href="https://developers.liveperson.com/agent-domain-domain-api.html"><i class="fas fa-external-link-alt" style="color:darkgray;"></i></a></td>
</tr>
<tr>
<td>File Sharing API</td>
<td>Upload images and other media to to storage for file sharing</td>
<td><a href="https://developers.liveperson.com/file-sharing-file-sharing-for-web-messaging.html"><i class="fas fa-external-link-alt" style="color:darkgray;"></i></a></td>
</tr>
<tr>
<td>Monitoring API</td>
<td>Create visitor and session id to provide additional conversation context</td>
<td><a href="https://developers.liveperson.com/monitoring-api-overview.html"><i class="fas fa-external-link-alt" style="color:darkgray;"></i></a></td>
</tr>
<tr>
<td>Consumer Messaging History API</td>
<td>Query current and past conversations of a consumer</td>
<td><a href="https://developers.liveperson.com/consumer-messaging-history-api-overview.html"><i class="fas fa-external-link-alt" style="color:darkgray;"></i></a></td>
</tr>
</tbody></table>

<aside class="warning">
 The Domain API is used for retrieving service domains, e.g., for authentication servers and for sending messages. For development purposes domains can be retrieved once, however, server domains can be subject to change.
</aside>
<h1 id='authentication'>Authentication</h1>
<p>The Connector API uses JWTs (JSON Web Token) to control access to the API. After you have obtained a <code>clientId</code> and <code>clientSecret</code> by installing an application manifest, you can use these to obtain a secure token, which is subsequently used in all Connector API requests. This token is a JSON Web Token (JWT). A JWT gives you the permission to send messages on behalf of consumers within a LiveEngage account. JWTs are only valid for a specific account and limited time duration.</p>

<blockquote>
<p>To authenticate, use this code:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST <span class="se">\</span>
https://<span class="k">${</span><span class="nv">authDomain</span><span class="k">}</span>/sentinel/api/account/<span class="k">${</span><span class="nv">accountId</span><span class="k">}</span>/app/token?<span class="se">\</span>
<span class="nv">v</span><span class="o">=</span>1.0&amp;grant_type<span class="o">=</span>client_credentials&amp;client_id<span class="o">=</span><span class="k">${</span><span class="nv">clientId</span><span class="k">}</span>&amp;client_secret<span class="o">=</span><span class="k">${</span><span class="nv">clientSecret</span><span class="k">}</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
</code></pre><pre class="highlight java tab-java"><code><span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>

<span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
  <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">"https://"</span><span class="o">+</span> <span class="n">authDomain</span> <span class="o">+</span><span class="s">"/sentinel/api/account/"</span><span class="o">+</span> <span class="n">accountId</span> <span class="o">+</span><span class="s">"/app/token?v=1.0&amp;grant_type=client_credentials&amp;client_id="</span><span class="o">+</span> <span class="n">clientId</span><span class="o">+</span> <span class="s">"&amp;client_secret="</span><span class="o">+</span> <span class="n">clientSecret</span><span class="o">)</span>
  <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="kc">null</span><span class="o">)</span>
  <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"application/x-www-form-urlencoded"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
</code></pre>
<blockquote>
<p>Make sure to replace <code>${accountId}</code>, <code>${clientId}</code>, and <code>${clientId}</code> with your keys.</p>

<p>You receive a response like this:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="o">{</span>
    <span class="s2">"access_token"</span>: <span class="s2">"eyJraWQiOiJhcHBqd3QtMTMtMDUtMTciLCJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiI1MzEzODQ2IiwiYXpwIjoiODJjNzMwNTMtZDc2My00NzUxLTkyNTYtZjNhNzk5YmM1NGM0Iiwic2NvcGUiOiJtc2cuY29uc3VtZXIiLCJpc3MiOiJTZW50aW5lbCIsImV4cCI6MTU1Mjg5OTM3OSwiaWF0IjoxNTUyODk1Nzc5fQ.rbnof2fWnMxFsubazxcGuAqxj04fwp4MgIgh3FjBv1pFoYmXOxCGjrq62x3SIab2Mp4pLdaWKI6UktatIsWK6cNnTvdJ_NQGE4I-8zC-fMk5fRp1CVFbVjxz0bgPeGPVzpWbgJGmhDVQMuqc2rGI8Rk9uP_aRwFDVPVZDOZ1AtAbGMigdjy7tdBD7Lr4w4vvMT6XW7lhHT0MJLJCQLACYAXbM0Q8ZLovq7vk2f-37BiHknP5LmAS1L_jRIL2encOINslYPNTjrPSEusKlJE2qpzbqvBFNlQlg62vzmdAj0xKKglmfOGdNHkKDEgH6haimxxN_LmzIN99Ew0I1ocJWg"</span>,
    <span class="s2">"token_type"</span>: <span class="s2">"Bearer"</span>
<span class="o">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="o">{</span>
    <span class="s">"access_token"</span><span class="o">:</span> <span class="s">"eyJraWQiOiJhcHBqd3QtMTMtMDUtMTciLCJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiI1MzEzODQ2IiwiYXpwIjoiODJjNzMwNTMtZDc2My00NzUxLTkyNTYtZjNhNzk5YmM1NGM0Iiwic2NvcGUiOiJtc2cuY29uc3VtZXIiLCJpc3MiOiJTZW50aW5lbCIsImV4cCI6MTU1Mjg5OTM3OSwiaWF0IjoxNTUyODk1Nzc5fQ.rbnof2fWnMxFsubazxcGuAqxj04fwp4MgIgh3FjBv1pFoYmXOxCGjrq62x3SIab2Mp4pLdaWKI6UktatIsWK6cNnTvdJ_NQGE4I-8zC-fMk5fRp1CVFbVjxz0bgPeGPVzpWbgJGmhDVQMuqc2rGI8Rk9uP_aRwFDVPVZDOZ1AtAbGMigdjy7tdBD7Lr4w4vvMT6XW7lhHT0MJLJCQLACYAXbM0Q8ZLovq7vk2f-37BiHknP5LmAS1L_jRIL2encOINslYPNTjrPSEusKlJE2qpzbqvBFNlQlg62vzmdAj0xKKglmfOGdNHkKDEgH6haimxxN_LmzIN99Ew0I1ocJWg"</span><span class="o">,</span>
    <span class="s">"token_type"</span><span class="o">:</span> <span class="s">"Bearer"</span>
<span class="o">}</span>
</code></pre>
<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h3 id='request-a-jwt'>Request a JWT</h3>
<p><strong>POST</strong> https://${authDomain}/sentinel/api/account/${accountId}/app/token?v=1.0
&amp;grant_type=client_credentials&amp;client_id=${clientId}&amp;client_secret=${clientSecret}</p>
<h4 id='headers'>Headers</h4>
<table><thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead><tbody>
<tr>
<td>Content-Type</td>
<td>application/json</td>
</tr>
</tbody></table>
<h4 id='request'>Request</h4>
<table><thead>
<tr>
<th>Variable</th>
<th>Description</th>
<th>Mandatory</th>
</tr>
</thead><tbody>
<tr>
<td>authDomain</td>
<td>CSDS domain of authentication service &#39;sentinel&#39;</td>
<td>true</td>
</tr>
<tr>
<td>brandId</td>
<td>Your account id</td>
<td>true</td>
</tr>
<tr>
<td>clientId</td>
<td>Client id obtained of your installed application.</td>
<td>true</td>
</tr>
<tr>
<td>clientSecret</td>
<td>Client secret of your installed application.</td>
<td>true</td>
</tr>
</tbody></table>
<h4 id='response'>Response</h4>
<p>If the login is successful the connector receives a HTTPS 200 response. </p>

<table><thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>access_token</td>
<td>JWT</td>
</tr>
<tr>
<td>token_type</td>
<td>Type of the token, i.e., Bearer</td>
</tr>
</tbody></table>

<aside class="warning">
Remember — manage your client keys and JWT securely!
</aside>

<blockquote>
<p>Parse the expiration date from the JWT like this:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="nb">echo</span> <span class="nv">$LP_JWT</span> | sed -e <span class="s1">'s/.*\.\(.*\)\..*/\1/'</span> | base64 --decode | grep -Eo <span class="s1">'"exp":(\d*)'</span>  | cut -d: -f
</code></pre><pre class="highlight shell tab-shell"><code><span class="nb">echo</span> <span class="nv">$LP_JWT</span> | sed -e <span class="s1">'s/.*\.\(.*\)\..*/\1/'</span> | base64 --decode | grep -Eo <span class="s1">'"exp":(\d*)'</span>  | cut -d: -f
</code></pre><pre class="highlight java tab-java"><code><span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="s">"..."</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">DecodedJWT</span> <span class="n">jwt</span> <span class="o">=</span> <span class="n">JWT</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
    <span class="n">Date</span> <span class="n">expiresAt</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="na">getExpiresAt</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JWTDecodeException</span> <span class="n">exception</span><span class="o">){</span>
    <span class="c1">//Invalid token</span>
<span class="o">}</span>
</code></pre><h3 id='jwt-expiration'>JWT expiration</h3>
<p>JWTs expire after a short time duration such as 1 hour. The expiration timestamp of the JWT can be extracted from the token itself.</p>

<p>In order to retrieve a new JWT before it expires login must be repeated. Subsequently, the newly issued AppJWT is sent with all requests.</p>

<aside class="success">
Your connector should cache the JWT for its duration of validity. It is recommended to renew the token 5 minutes before it is invalidated. 
</aside>
<h3 id='use-a-jwt'>Use a JWT</h3>
<p>Having obtained a valid JWT, you must set an <code>Authentication</code> header in all subsequent Connector API HTTPS requests:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead><tbody>
<tr>
<td>Authorization</td>
<td>JWT value</td>
</tr>
</tbody></table>
<h1 id='consumer-identity'>Consumer identity</h1>
<p>The JWT authorizes your connector to perform actions on behalf of a customer, e.g., to create conversations and send messages. The identity of the customer itself is defined in a JSON Web Signature (JWS). This token has to be obtained separately, and used in all subsequent requests for a specific customer.  </p>
<pre class="highlight shell tab-shell"><code>curl -X POST <span class="se">\</span>
  <span class="s1">'https://${idpDomain}/api/account/${accountId}/consumer?v=1.0'</span> <span class="se">\</span>
  -H <span class="s1">'Authorization: ${JWT} \
  -H '</span>Content-Type: application/json<span class="s1">' \
  -d '</span><span class="o">{</span>
    <span class="s2">"ext_consumer_id"</span>: <span class="s2">"</span><span class="k">${</span><span class="nv">customerId</span><span class="k">}</span><span class="s2">"</span>
  <span class="o">}</span><span class="s1">'
</span></code></pre><pre class="highlight java tab-java"><code><span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>

<span class="n">MediaType</span> <span class="n">mediaType</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
<span class="n">RequestBody</span> <span class="n">body</span> <span class="o">=</span> <span class="n">RequestBody</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">mediaType</span><span class="o">,</span> <span class="s">"{\n\t\"ext_consumer_id\":\"vf-random_id0.33113136892746214548813983913\"\n}"</span><span class="o">);</span>
<span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
  <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">"https://"</span> <span class="o">+</span> <span class="n">idpDomain</span> <span class="o">+</span> <span class="s">"/api/account/"</span><span class="o">+</span> <span class="n">accountId</span> <span class="o">+</span><span class="s">"/consumer?v=1.0"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
  <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"application/json"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">,</span> <span class="n">jwt</span><span class="o">)</span>
  <span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
</code></pre>
<blockquote>
<p>If succcessful a 201 response is returned with the JWS:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="o">{</span>
    <span class="s2">"token"</span>: <span class="s2">"eyJraWQiOiJhcHBqd3QtMTMtMDUtMTciLCJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhY2NvdW50X2lkIjoiNTMxMzg0NiIsImV4dF9jb25zdW1lcl9pZCI6InZmLXJhbmRvbV9pZDAuNjg5Mjc0NjIxNDM0MTM0MzI0IiwibHBfY29uc3VtZXJfaWQiOiJhYjMxNzNiZDAxY2IyMDAzMjM4YzM5NTI1ZjE5NDQ0MmM2YmQzMmM2YWYwZTZiYjAyZjY1ZGE2MWI5NmI1ZjIyIn0.SoHQAmoNqCxut73EEFgqYX1y5JOD4skDhGpzko8TMcFxFJnwJChvpKwGTRFIpBFfP0JPItqpKNUs7CrwtpZO4GCTZ9nRJXDMgJ6zpL_-8_aJTxDkryWLk4q1NdqJy7KMebFIRCmzGhcmRGiRcJbceqIgX4hkmcY_tSFLQjVk8_oSrw8w_sv1uarOvFn7q-1XX3bt2eTqJDlq1qT7tAwxiaLESWipjX9H3DajmcUlknTcmyLINAZ3FD5bDtKE6Q_wFM43TCK952kCbjUnJN9txblX-Z1D5LHuV3rsKKUYAYDq09A4_D5G8b3RZggF72llsDUc8JS2mFTrmpoh54hVcg"</span>
<span class="o">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="o">{</span>
    <span class="s">"token"</span><span class="o">:</span> <span class="s">"eyJraWQiOiJhcHBqd3QtMTMtMDUtMTciLCJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhY2NvdW50X2lkIjoiNTMxMzg0NiIsImV4dF9jb25zdW1lcl9pZCI6InZmLXJhbmRvbV9pZDAuNjg5Mjc0NjIxNDM0MTM0MzI0IiwibHBfY29uc3VtZXJfaWQiOiJhYjMxNzNiZDAxY2IyMDAzMjM4YzM5NTI1ZjE5NDQ0MmM2YmQzMmM2YWYwZTZiYjAyZjY1ZGE2MWI5NmI1ZjIyIn0.SoHQAmoNqCxut73EEFgqYX1y5JOD4skDhGpzko8TMcFxFJnwJChvpKwGTRFIpBFfP0JPItqpKNUs7CrwtpZO4GCTZ9nRJXDMgJ6zpL_-8_aJTxDkryWLk4q1NdqJy7KMebFIRCmzGhcmRGiRcJbceqIgX4hkmcY_tSFLQjVk8_oSrw8w_sv1uarOvFn7q-1XX3bt2eTqJDlq1qT7tAwxiaLESWipjX9H3DajmcUlknTcmyLINAZ3FD5bDtKE6Q_wFM43TCK952kCbjUnJN9txblX-Z1D5LHuV3rsKKUYAYDq09A4_D5G8b3RZggF72llsDUc8JS2mFTrmpoh54hVcg"</span>
<span class="o">}</span>
</code></pre>
<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h3 id='retrieve-a-jws'>Retrieve a JWS</h3>
<p>Use the domain API to retrieve the domain of the LivePerson IDP service. The <code>accountId</code> is specified as a variable in the path.</p>
<h3 id='request-2'>Request</h3>
<p><strong>POST</strong> https://${idpDomain}/api/account/${accountId}/consumer?v=1.0&#39;</p>
<h4 id='headers-2'>Headers</h4>
<table><thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead><tbody>
<tr>
<td>Authorization</td>
<td>JWT value</td>
</tr>
<tr>
<td>Content-Type</td>
<td>application/json</td>
</tr>
</tbody></table>
<h4 id='request-body'>Request body</h4>
<p>The request body defines the customer&#39;s id in <code>ext_consumer_id</code>:</p>
<h3 id='response-2'>Response</h3>
<p>If the request is successful a HTTPS 201 <code>Created</code> is returned with the JWS <code>token</code> in the body.</p>
<h3 id='use-the-jws'>Use the JWS</h3>
<p>Having obtained a valid JWS, you must set an <code>X-LP-ON-BEHALF</code> header in all subsequent requests to Connector API:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead><tbody>
<tr>
<td>X-LP-ON-BEHALF</td>
<td>JWS value</td>
</tr>
<tr>
<td>Authorization</td>
<td>JWT value</td>
</tr>
<tr>
<td>Content-Type</td>
<td>application/json</td>
</tr>
</tbody></table>

<aside class="success">
A JWS does not expire and should be cached by your connector implementation.  
</aside>
<h1 id='conversation'>Conversation</h1><h2 id='create-a-conversation'>Create a conversation</h2><pre class="highlight shell tab-shell"><code>curl -X POST <span class="se">\</span>
  <span class="s1">'https://va-at.msg.liveperson.net/api/account/5313846/messaging/consumer/conversation?v=3'</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'Authorization: ${JWT}'</span> <span class="se">\</span>
  -H <span class="s1">'X-LP-ON-BEHALF: ${JWS}'</span> <span class="se">\</span>
  -d <span class="s1">'[{
        "kind": "req",
        "id": "4b91dd19-9b0c-4354-8fef-4f58a45a9c57",
        "type": "userprofile.SetUserProfile",
        "body": {
           "authenticatedData": {
                "lp_sdes": [
                    {
                        "type": "ctmrinfo",
                        "info": {
                            "customerId": "138766AZE",
                            "socialId": "1125632",
                            "imei": "35433545688",
                            "userName": "user000"
                        }
                    },
                    {
                        "type": "personal",
                        "personal": {
                            "firstname": "John",
                            "lastname": "Doe"
                        }
                    }
                ]
            }
        }
    },
    {
        "kind": "req",
        "id": "533575ec-b092-4ea6-ba13-25a98095e79f",
        "type": "cm.ConsumerRequestConversation",
        "body": {
            "channelType": "MESSAGING",
            "brandId": "${accountId}"
        }
    }
]'</span>
</code></pre><pre class="highlight java tab-java"><code><span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>

<span class="n">MediaType</span> <span class="n">mediaType</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
<span class="n">RequestBody</span> <span class="n">body</span> <span class="o">=</span> <span class="n">RequestBody</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">mediaType</span><span class="o">,</span> <span class="s">"[{
        "</span><span class="n">kind</span><span class="s">": "</span><span class="n">req</span><span class="s">",
        "</span><span class="n">id</span><span class="s">": "</span><span class="mi">4</span><span class="n">b91dd19</span><span class="o">-</span><span class="mi">9</span><span class="n">b0c</span><span class="o">-</span><span class="mi">4354</span><span class="o">-</span><span class="mi">8</span><span class="n">fef</span><span class="o">-</span><span class="mi">4</span><span class="n">f58a45a9c57</span><span class="s">",
        "</span><span class="n">type</span><span class="s">": "</span><span class="n">userprofile</span><span class="o">.</span><span class="na">SetUserProfile</span><span class="s">",
        "</span><span class="n">body</span><span class="s">": {
           "</span><span class="n">authenticatedData</span><span class="s">": {
                "</span><span class="n">lp_sdes</span><span class="s">": [
                    {
                        "</span><span class="n">type</span><span class="s">": "</span><span class="n">ctmrinfo</span><span class="s">",
                        "</span><span class="n">info</span><span class="s">": {
                            "</span><span class="n">customerId</span><span class="s">": "</span><span class="mi">138766</span><span class="n">AZE</span><span class="s">",
                            "</span><span class="n">socialId</span><span class="s">": "</span><span class="mi">1125632</span><span class="s">",
                            "</span><span class="n">imei</span><span class="s">": "</span><span class="mi">35433545688</span><span class="s">",
                            "</span><span class="n">userName</span><span class="s">": "</span><span class="n">user000</span><span class="s">"
                        }
                    },
                    {
                        "</span><span class="n">type</span><span class="s">": "</span><span class="n">personal</span><span class="s">",
                        "</span><span class="n">personal</span><span class="s">": {
                            "</span><span class="n">firstname</span><span class="s">": "</span><span class="n">John</span><span class="s">",
                            "</span><span class="n">lastname</span><span class="s">": "</span><span class="n">Doe</span><span class="s">"
                        }
                    }
                ]
            }
        }
    },
    {
        "</span><span class="n">kind</span><span class="s">": "</span><span class="n">req</span><span class="s">",
        "</span><span class="n">id</span><span class="s">": "</span><span class="mi">533575</span><span class="n">ec</span><span class="o">-</span><span class="n">b092</span><span class="o">-</span><span class="mi">4</span><span class="n">ea6</span><span class="o">-</span><span class="n">ba13</span><span class="o">-</span><span class="mi">25</span><span class="n">a98095e79f</span><span class="s">",
        "</span><span class="n">type</span><span class="s">": "</span><span class="n">cm</span><span class="o">.</span><span class="na">ConsumerRequestConversation</span><span class="s">",
        "</span><span class="n">body</span><span class="s">": {
            "</span><span class="n">channelType</span><span class="s">": "</span><span class="n">MESSAGING</span><span class="s">",
            "</span><span class="n">brandId</span><span class="s">": accountId
        }
    }
]"</span><span class="o">);</span>
<span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
  <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">"https://va-at.msg.liveperson.net/api/account/5313846/messaging/consumer/conversation?v=3"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
  <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">,</span> <span class="n">jwt</span><span class="o">)</span>
  <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"X-LP-ON-BEHALF"</span><span class="o">,</span> <span class="n">jws</span><span class="o">)</span>
  <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"application/json"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
</code></pre>
<blockquote>
<p>If succcessful a 200 response is returned:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="o">[</span>
    <span class="o">{</span>
        <span class="s2">"code"</span>: <span class="s2">"OK"</span>,
        <span class="s2">"body"</span>: <span class="o">{</span>
            <span class="s2">"msg"</span>: <span class="s2">"OK User Profile set successfully"</span>
        <span class="o">}</span>,
        <span class="s2">"reqId"</span>: <span class="s2">"4b91dd19-9b0c-4354-8fef-4f58a45a9c57"</span>
    <span class="o">}</span>,
    <span class="o">{</span>
        <span class="s2">"code"</span>: <span class="s2">"OK"</span>,
        <span class="s2">"body"</span>: <span class="o">{</span>
            <span class="s2">"conversationId"</span>: <span class="s2">"cbf6e739-dfe6-4e3c-a544-2504afbe8747"</span>
        <span class="o">}</span>,
        <span class="s2">"reqId"</span>: <span class="s2">"533575ec-b092-4ea6-ba13-25a98095e79f"</span>
    <span class="o">}</span>
<span class="o">]</span>
</code></pre><pre class="highlight java tab-java"><code><span class="o">[</span>
    <span class="o">{</span>
        <span class="s">"code"</span><span class="o">:</span> <span class="s">"OK"</span><span class="o">,</span>
        <span class="s">"body"</span><span class="o">:</span> <span class="o">{</span>
            <span class="s">"msg"</span><span class="o">:</span> <span class="s">"OK User Profile set successfully"</span>
        <span class="o">},</span>
        <span class="s">"reqId"</span><span class="o">:</span> <span class="s">"4b91dd19-9b0c-4354-8fef-4f58a45a9c57"</span>
    <span class="o">},</span>
    <span class="o">{</span>
        <span class="s">"code"</span><span class="o">:</span> <span class="s">"OK"</span><span class="o">,</span>
        <span class="s">"body"</span><span class="o">:</span> <span class="o">{</span>
            <span class="s">"conversationId"</span><span class="o">:</span> <span class="s">"cbf6e739-dfe6-4e3c-a544-2504afbe8747"</span>
        <span class="o">},</span>
        <span class="s">"reqId"</span><span class="o">:</span> <span class="s">"533575ec-b092-4ea6-ba13-25a98095e79f"</span>
    <span class="o">}</span>
<span class="o">]</span>
</code></pre>
<p>A new conversation is created by sending a HTTPS POST request to the Connector API <code>/conversation</code> endpoint. The URL includes the domain of the Messaging Service and the <code>accountId</code>. The query parameter <code>v=3</code> specifies the API version. In the HTTP headers both the authentication JWT and customer JWS must be included. </p>

<p>Every event has a <code>type</code> and an <code>id</code>. To generate the <code>id</code> in each request please use a UUID library of your choice to automatically generate an ID that adheres to the Universally Unique Identifier (UUID) v4 standard.</p>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h3 id='request-3'>Request</h3>
<p><strong>POST</strong> https://${messagingDomain}/api/account/${accountId}/messaging/consumer/conversation?v=3</p>

<aside>
To find the `messagingDomain` domain, please use the Domain API with your account id and the service id `asnycMessagingEnt`.
</aside>
<h3 id='https-headers'>HTTPS headers</h3>
<table><thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead><tbody>
<tr>
<td>X-LP-ON-BEHALF</td>
<td>JWS value</td>
</tr>
<tr>
<td>Authorization</td>
<td>JWT value</td>
</tr>
<tr>
<td>Content-Type</td>
<td>application/json</td>
</tr>
</tbody></table>
<h3 id='payload'>Payload</h3>
<p>The request payload is an array containing the following payloads. The payloads is ordered in a JSON array as follows: </p>

<table><thead>
<tr>
<th>Request object</th>
<th>Description</th>
<th>Mandatory</th>
</tr>
</thead><tbody>
<tr>
<td>userprofile.SetUserProfile</td>
<td>Set the user profile. <code>lp-sdes</code> defines engagement attributes that can hold customer <code>type=ctmrinfo</code> or personal <code>type=personal</code> information</td>
<td>true</td>
</tr>
<tr>
<td>cm.ConsumerRequestConversation</td>
<td>Request a conversation</td>
<td>true</td>
</tr>
</tbody></table>

<p>The allowed Engagement Attributes are <code>ctmrinfo</code> <a href="https://developers.liveperson.com/data-access-api-methods-web-session.html#engagement-attribute-type---customer-info"><i class="fas fa-external-link-alt" style="color:darkgray;"></i></a> and <code>personal</code> <a href="https://developers.liveperson.com/data-access-api-methods-web-session.html#engagement-attribute-type---personal-info"><i class="fas fa-external-link-alt" style="color:darkgray;"></i></a>.</p>
<h3 id='response-3'>Response</h3>
<p>If successsul a 200 response is returned with a JSON array in the same order as the events in the request. In the second response object the <code>conversationId</code>is wrapped as part of the body. The connector will subsequently use this <code>conversationId</code> for in all messages for this customer.</p>

<aside class="warning">
The conversation id for a customer is managed by the connector. There can be cases where a conversation has been closed not by the connector but by an agent or the system. In this case, a new conversation has to be created. 
</aside>
<h2 id='create-a-conversation-with-skill-routing'>Create a conversation with skill routing</h2><pre class="highlight shell tab-shell"><code>curl -X POST <span class="se">\</span>
  <span class="s1">'https://${messagingDomain}/api/account/${accountId}/messaging/consumer/conversation?v=3'</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'Authorization: ${JWT}'</span> <span class="se">\</span>
  -H <span class="s1">'X-LP-ON-BEHALF: ${JWS}'</span> <span class="se">\</span>
  -d <span class="s1">'[{
        "kind": "req",
        "id": "4b91dd19-9b0c-4354-8fef-4f58a45a9c57",
        "type": "userprofile.SetUserProfile",
        "body": {
           "authenticatedData": {
                "lp_sdes": [
                    {
                        "type": "personal",
                        "personal": {
                            "firstname": "John",
                            "lastname": "Doe"
                        }
                    }
                ]
            }
        }
    },
    {
        "kind": "req",
        "id": "533575ec-b092-4ea6-ba13-25a98095e79f",
        "type": "cm.ConsumerRequestConversation",
        "body": {
            "channelType": "MESSAGING",
            "brandId": "${accountId}"
      "campaignInfo": {
                "campaignId": "${campaignId}",
                "engagementId": "${engagementId}"
            }
        }
    }
]'</span>
</code></pre>
<blockquote>
<p>If succcessful a 200 response is returned:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="o">[</span>
    <span class="o">{</span>
        <span class="s2">"code"</span>: <span class="s2">"OK"</span>,
        <span class="s2">"body"</span>: <span class="o">{</span>
            <span class="s2">"msg"</span>: <span class="s2">"OK User Profile set successfully"</span>
        <span class="o">}</span>,
        <span class="s2">"reqId"</span>: <span class="s2">"4b91dd19-9b0c-4354-8fef-4f58a45a9c57"</span>
    <span class="o">}</span>,
    <span class="o">{</span>
        <span class="s2">"code"</span>: <span class="s2">"OK"</span>,
        <span class="s2">"body"</span>: <span class="o">{</span>
            <span class="s2">"conversationId"</span>: <span class="s2">"cbf6e739-dfe6-4e3c-a544-2504afbe8747"</span>
        <span class="o">}</span>,
        <span class="s2">"reqId"</span>: <span class="s2">"533575ec-b092-4ea6-ba13-25a98095e79f"</span>
    <span class="o">}</span>
<span class="o">]</span>
</code></pre><pre class="highlight java tab-java"><code><span class="o">[</span>
    <span class="o">{</span>
        <span class="s">"code"</span><span class="o">:</span> <span class="s">"OK"</span><span class="o">,</span>
        <span class="s">"body"</span><span class="o">:</span> <span class="o">{</span>
            <span class="s">"msg"</span><span class="o">:</span> <span class="s">"OK User Profile set successfully"</span>
        <span class="o">},</span>
        <span class="s">"reqId"</span><span class="o">:</span> <span class="s">"4b91dd19-9b0c-4354-8fef-4f58a45a9c57"</span>
    <span class="o">},</span>
    <span class="o">{</span>
        <span class="s">"code"</span><span class="o">:</span> <span class="s">"OK"</span><span class="o">,</span>
        <span class="s">"body"</span><span class="o">:</span> <span class="o">{</span>
            <span class="s">"conversationId"</span><span class="o">:</span> <span class="s">"cbf6e739-dfe6-4e3c-a544-2504afbe8747"</span>
        <span class="o">},</span>
        <span class="s">"reqId"</span><span class="o">:</span> <span class="s">"533575ec-b092-4ea6-ba13-25a98095e79f"</span>
    <span class="o">}</span>
<span class="o">]</span>
</code></pre>
<p>Skill routing is decided upon conversation creation. If you are planning to route a customer to a specific skill then you should use a campaign with engagement for this.  </p>

<p>It is recommended to set up skill routing with an engagement and campaign. For this, it is required to add a <code>conversationContext</code> object to the request. It specifies the <code>engagementId</code> and <code>campaignId</code>. If you do not have a campaign defined yet, you should create one for the connector. </p>

<p>Campaigns and engagement can be created in two different ways:</p>

<ol>
<li><p>Programatically with the Mononitoring API </p></li>
<li><p>Manually with the &quot;Campaign&quot; tab in LiveEngage</p></li>
</ol>

<p>In LiveEngage, the <code>engagementId</code> and <code>campaignId</code>are shown as seen below: </p>

<p><img src="images/campaign_engagement_ids.png" title="Mockup - Create a Connector App" alt="mockup" /></p>

<aside class="warning">
Please note: A campaign and engagement when creating a conversation is a prerequisite to reporting!
</aside>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h3 id='conversation-already-exists'>Conversation already exists</h3>
<blockquote>
<p>If a conversation already exists you will receive a response like this:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="o">[</span>
    <span class="o">{</span>
        <span class="s2">"code"</span>: <span class="s2">"OK"</span>,
        <span class="s2">"body"</span>: <span class="o">{</span>
            <span class="s2">"msg"</span>: <span class="s2">"OK User Profile set successfully"</span>
        <span class="o">}</span>,
        <span class="s2">"reqId"</span>: <span class="s2">"4b91dd19-9b0c-4354-8fef-4f58a45a9c57"</span>
    <span class="o">}</span>,
    <span class="o">{</span>
        <span class="s2">"code"</span>: <span class="s2">"BAD_REQUEST"</span>,
        <span class="s2">"body"</span>: <span class="o">{</span>
            <span class="s2">"msg"</span>: <span class="s2">"Consumer request conversation failed: User 77d338e4b6bf02affbf9bf00a779cbf06b0fcd7fb1674028e8739acdfa6ae7a2 already has open conversation. Can't open another one."</span>
        <span class="o">}</span>,
        <span class="s2">"reqId"</span>: <span class="s2">"533575ec-b092-4ea6-ba13-25a98095e79f"</span>
    <span class="o">}</span>
<span class="o">]</span>
</code></pre><pre class="highlight java tab-java"><code><span class="o">[</span>
    <span class="o">{</span>
        <span class="s">"code"</span><span class="o">:</span> <span class="s">"OK"</span><span class="o">,</span>
        <span class="s">"body"</span><span class="o">:</span> <span class="o">{</span>
            <span class="s">"msg"</span><span class="o">:</span> <span class="s">"OK User Profile set successfully"</span>
        <span class="o">},</span>
        <span class="s">"reqId"</span><span class="o">:</span> <span class="s">"4b91dd19-9b0c-4354-8fef-4f58a45a9c57"</span>
    <span class="o">},</span>
    <span class="o">{</span>
        <span class="s">"code"</span><span class="o">:</span> <span class="s">"BAD_REQUEST"</span><span class="o">,</span>
        <span class="s">"body"</span><span class="o">:</span> <span class="o">{</span>
            <span class="s">"msg"</span><span class="o">:</span> <span class="s">"Consumer request conversation failed: User 77d338e4b6bf02affbf9bf00a779cbf06b0fcd7fb1674028e8739acdfa6ae7a2 already has open conversation. Can't open another one."</span>
        <span class="o">},</span>
        <span class="s">"reqId"</span><span class="o">:</span> <span class="s">"533575ec-b092-4ea6-ba13-25a98095e79f"</span>
    <span class="o">}</span>
<span class="o">]</span>
</code></pre>
<p>If a conversation already exists a <code>400 Bad Request</code> response is returned. It is expected that the <code>conversationId</code> is managed by the connector.</p>
<h2 id='close-conversation'>Close conversation</h2>
<blockquote>
<p>A conversation is closed by sending a state update event:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST <span class="se">\</span>
  <span class="s1">'https://${messagingDomain}/api/account/${accountId}/messaging/consumer/conversation/send?v=3'</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'Authorization: ${JWT}'</span> <span class="se">\</span>
  -H <span class="s1">'X-LP-ON-BEHALF: ${JWS}'</span> <span class="se">\</span>
  -d <span class="s1">'{
 "kind": "req",
 "id": "c4255004-9c50-4405-8cba-475d761fab1b",
 "body": {
   "conversationId": "cbf6e739-dfe6-4e3c-a544-2504afbe8747",
   "conversationField": {
     "field": "ConversationStateField",
     "conversationState": "CLOSE"
   }
 },
 "type": "cm.UpdateConversationField"
}'</span>
</code></pre>
<blockquote>
<p>You get the following response if successfull:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="o">{</span>
    <span class="s2">"code"</span>: <span class="s2">"OK"</span>,
    <span class="s2">"body"</span>: <span class="o">{</span>
        <span class="s2">"msg"</span>: <span class="s2">"OK Conversation resolved successfully"</span>
    <span class="o">}</span>,
    <span class="s2">"reqId"</span>: <span class="s2">"c4255004-9c50-4405-8cba-475d761fab1b"</span>
<span class="o">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="o">{</span>
    <span class="s">"code"</span><span class="o">:</span> <span class="s">"OK"</span><span class="o">,</span>
    <span class="s">"body"</span><span class="o">:</span> <span class="o">{</span>
        <span class="s">"msg"</span><span class="o">:</span> <span class="s">"OK Conversation resolved successfully"</span>
    <span class="o">},</span>
    <span class="s">"reqId"</span><span class="o">:</span> <span class="s">"c4255004-9c50-4405-8cba-475d761fab1b"</span>
<span class="o">}</span>
</code></pre>
<p>A custom connector can close a conversation at any time. Typically, conversations are closed when the customer&#39;s request is resolved. Because many Messaging apps do not have a notion of &quot;close&quot; or &quot;resolve&quot; you may choose not to close conversations by the connector at all. However, it is still possible that an agent or the system closes a conversation state&mdash;conversation state changes by other participants are tracked by analyzing Webhook notifcations.</p>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h3 id='request-4'>Request</h3>
<p><strong>POST</strong> https://${messagingDomain}/api/account/${accountId}/messaging/consumer/conversation/send?v=3&#39;</p>
<h3 id='https-headers-2'>HTTPS headers</h3>
<table><thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead><tbody>
<tr>
<td>X-LP-ON-BEHALF</td>
<td>JWS value</td>
</tr>
<tr>
<td>Authorization</td>
<td>JWT value</td>
</tr>
<tr>
<td>Content-Type</td>
<td>application/json</td>
</tr>
</tbody></table>
<h3 id='payload-2'>Payload</h3>
<p>The request payload is an array containing the following payloads. The payloads is ordered in a JSON array as follows: </p>

<table><thead>
<tr>
<th>Request object</th>
<th>Description</th>
<th>Mandatory</th>
</tr>
</thead><tbody>
<tr>
<td>cm.UpdateConversationField</td>
<td>Updates the conversation state in the <code>body</code> field. Required inputs are the <code>conversationId</code> and <code>conversationField</code> with the <code>conversationState</code> = &quot;CLOSE&quot;</td>
<td>true</td>
</tr>
</tbody></table>
<h3 id='response-4'>Response</h3>
<p>If successsul a <code>200 OK</code> response is returned with <code>code=&quot;OK&quot;</code> in the JSON response body.</p>
<h1 id='send-a-message'>Send a message</h1>
<blockquote>
<p>Send a plain text message:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST <span class="se">\</span>
  <span class="s1">'https://${messagingDomain}/api/account/${accountId}/messaging/consumer/conversation/send?v=3'</span> <span class="se">\</span>
  -H <span class="s1">'Authorization: ${JWT}'</span> <span class="se">\</span>
  -H <span class="s1">'X-LP-ON-BEHALF: ${JWS}'</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "kind": "req",
    "type": "ms.PublishEvent",
    "id": "1556852a-4bb3-11e9-8646-d663bd873d93",
    "body": {
        "conversationId": "cbf6e739-dfe6-4e3c-a544-2504afbe8747",
        "dialogId": "cbf6e739-dfe6-4e3c-a544-2504afbe8747",
          "event": {
              "type": "ContentEvent",
              "contentType": "text/plain",
              "message": Hello world!"
          }
    }
  }'</span>
</code></pre><pre class="highlight java tab-java"><code><span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>

<span class="n">MediaType</span> <span class="n">mediaType</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
<span class="n">RequestBody</span> <span class="n">body</span> <span class="o">=</span> <span class="n">RequestBody</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">mediaType</span><span class="o">,</span> <span class="s">"{
    "</span><span class="n">kind</span><span class="s">": "</span><span class="n">req</span><span class="s">",
    "</span><span class="n">type</span><span class="s">": "</span><span class="n">ms</span><span class="o">.</span><span class="na">PublishEvent</span><span class="s">",
    "</span><span class="n">id</span><span class="s">": "</span><span class="mi">1556852</span><span class="n">a</span><span class="o">-</span><span class="mi">4</span><span class="n">bb3</span><span class="o">-</span><span class="mi">11</span><span class="n">e9</span><span class="o">-</span><span class="mi">8646</span><span class="o">-</span><span class="n">d663bd873d93</span><span class="s">",
    "</span><span class="n">body</span><span class="s">": {
        "</span><span class="n">conversationId</span><span class="s">": "</span><span class="n">cbf6e739</span><span class="o">-</span><span class="n">dfe6</span><span class="o">-</span><span class="mi">4</span><span class="n">e3c</span><span class="o">-</span><span class="n">a544</span><span class="o">-</span><span class="mi">2504</span><span class="n">afbe8747</span><span class="s">",
        "</span><span class="n">dialogId</span><span class="s">": "</span><span class="n">cbf6e739</span><span class="o">-</span><span class="n">dfe6</span><span class="o">-</span><span class="mi">4</span><span class="n">e3c</span><span class="o">-</span><span class="n">a544</span><span class="o">-</span><span class="mi">2504</span><span class="n">afbe8747</span><span class="s">",
          "</span><span class="n">event</span><span class="s">": {
              "</span><span class="n">type</span><span class="s">": "</span><span class="n">ContentEvent</span><span class="s">",
              "</span><span class="n">contentType</span><span class="s">": "</span><span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="s">",
              "</span><span class="n">message</span><span class="s">": Hello world!"</span>
          <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span><span class="s">");
Request request = new Request.Builder()
  .url("</span><span class="nl">https:</span><span class="c1">//"+ messagingDomain +"/api/account/"+ accountId +"/messaging/consumer/conversation/send?v=3")</span>
  <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
  <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">,</span> <span class="n">jwt</span><span class="o">)</span>
  <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"X-LP-ON-BEHALF"</span><span class="o">,</span> <span class="n">jws</span><span class="o">)</span>
  <span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"application/json"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
</code></pre>
<blockquote>
<p>A <code>200 OK</code> with the following JSON response is returned:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="o">{</span>
    <span class="s2">"code"</span>: <span class="s2">"OK"</span>,
    <span class="s2">"body"</span>: <span class="o">{</span>
        <span class="s2">"sequence"</span>: 0
    <span class="o">}</span>,
    <span class="s2">"reqId"</span>: <span class="s2">"1556852a-4bb3-11e9-8646-d663bd873d93"</span>
<span class="o">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="o">{</span>
    <span class="s">"code"</span><span class="o">:</span> <span class="s">"OK"</span><span class="o">,</span>
    <span class="s">"body"</span><span class="o">:</span> <span class="o">{</span>
        <span class="s">"sequence"</span><span class="o">:</span> <span class="mi">0</span>
    <span class="o">},</span>
    <span class="s">"reqId"</span><span class="o">:</span> <span class="s">"1556852a-4bb3-11e9-8646-d663bd873d93"</span>
<span class="o">}</span>
</code></pre>
<p>The Connector API <code>/send</code> endpoint is used to send messages in an open conversation. A text message is published by sending a <code>PublishEvent</code> event object.</p>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h3 id='request-5'>Request</h3>
<p><strong>POST</strong> https://${messagingDomain}/api/account/${accountId}/messaging/consumer/conversation/send?v=3</p>
<h3 id='https-headers-3'>HTTPS headers</h3>
<table><thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead><tbody>
<tr>
<td>X-LP-ON-BEHALF</td>
<td>JWS value</td>
</tr>
<tr>
<td>Authorization</td>
<td>JWT value</td>
</tr>
<tr>
<td>Content-Type</td>
<td>application/json</td>
</tr>
</tbody></table>
<h3 id='payload-3'>Payload</h3>
<table><thead>
<tr>
<th>Request object</th>
<th>Description</th>
<th>Mandatory</th>
</tr>
</thead><tbody>
<tr>
<td>ms.PublishEvent</td>
<td>Event type for publishing messages in a conversation the contentType  text/plain indicates a text event</td>
<td>true</td>
</tr>
</tbody></table>

<p>The request object defines both a <code>conversationId</code> and <code>dialogId</code>. When a conversation is opened, the system automatically creates a MAIN dialog with the same id. Depending on the functional scope there may multiple dialogs<a href="https://developers.liveperson.com/messaging-window-api-tutorials-post-conversation-survey-pcs.html#multi-dialog-conversation"><i class="fas fa-external-link-alt" style="color:darkgray;"></i></a>. For example, if a survey is initiated the MAIN dialog is closed and a new dialog POST_SURVEY is opened. If your connector shall support surveys, it has track conversation and dialog changes using Webhook notifications. </p>
<h3 id='response-5'>Response</h3>
<table><thead>
<tr>
<th>Attribute</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>code</td>
<td>&#39;OK&#39; indicates that the message is successfully sent</td>
</tr>
<tr>
<td>reqId</td>
<td>The request id in the response</td>
</tr>
<tr>
<td>sequenceId</td>
<td>ordered no. of the message within the conversation, the first message&#39;s sequenceId is 0</td>
</tr>
</tbody></table>

<blockquote>
<p>If a message exceeds the maximum size a <code>400 Bad Request</code> is returned:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="o">{</span>
    <span class="s2">"code"</span>: <span class="s2">"BAD_REQUEST"</span>,
    <span class="s2">"body"</span>: <span class="o">{</span>
        <span class="s2">"msg"</span>: <span class="s2">"Bad Request"</span>
    <span class="o">}</span>,
    <span class="s2">"reqId"</span>: <span class="s2">"1556852a-4bb3-11e9-8646-d663bd873d93"</span>
<span class="o">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="o">{</span>
    <span class="s">"code"</span><span class="o">:</span> <span class="s">"BAD_REQUEST"</span><span class="o">,</span>
    <span class="s">"body"</span><span class="o">:</span> <span class="o">{</span>
        <span class="s">"msg"</span><span class="o">:</span> <span class="s">"Bad Request"</span>
    <span class="o">},</span>
    <span class="s">"reqId"</span><span class="o">:</span> <span class="s">"1556852a-4bb3-11e9-8646-d663bd873d93"</span>
<span class="o">}</span>
</code></pre>
<aside class="warning">
The size of the JSON request object cannot exceed 5000 characters. If a message exceeds the maximum size a `400 Bad Request` response will be returned.
</aside>
<h1 id='webhooks'>Webhooks</h1>
<p>Connector API <code>/conversation</code> and <code>/send</code> endpoints provide you with the means to send customer messages to LiveEngage Messaging. If you want to receive updates on a conversation, e.g. messages sent by an agent, you have to expose a public HTTPS POST Webhook endpoint to receive those notifications. </p>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h2 id='requirements'>Requirements</h2>
<p>The Webhook notifications are sent as POST requests over SSL only (HTTPS). The application endpoint is required to be set up with a <strong>valid</strong> web-server TLS/SSL certificate.</p>

<p>The application endpoint is expected to <strong>immediately</strong> respond to each a notification request. A response delay can lead to a timeout of that notification request.</p>

<p>The application endpoint is expected to respond with either a <code>200 OK</code> or <code>201 Created</code> HTTPS response code to each a notification request. Any other response code will be considered as a notification request failure.</p>

<aside class="warning">
The Webhook notifications are sent globally for all Messaging channels of an account. A registered endpoint will also receive notifications on conversations that were started outside of your connector.
</aside>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h2 id='authentication-2'>Authentication</h2>
<p>Authentication is verified by your Webhook endpoint based on the <code>clientId</code> and <code>clientSecret</code> of your Webhook notification. For authentication it is required to analyze all HTTPS POST request headers and check the SHA1 signature of the payload using <code>clientSecret</code> as the key. </p>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h3 id='request-headers'>Request headers</h3>
<table><thead>
<tr>
<th>Header</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>x-liveperson-account-id</td>
<td>The unique LivePerson account identifier. Can be used to differentiate registration of different accounts, when the same url is used for multiple accounts.</td>
</tr>
<tr>
<td>x-liveperson-client-id</td>
<td>The unique client application identifier. The client_id that the consumer receives from their account manager after the App Installation process.</td>
</tr>
<tr>
<td>x-liveperson-signature</td>
<td>A token generated by signing the payload using the client-secret. A SHA1 signature of the payload and the client_secret (given by the account manager in the Application Installation process) preceded with “sha1=”.</td>
</tr>
</tbody></table>
<h2 id='notification-types'>Notification types</h2>
<p>The notification types that your connector subscribes to as defined in the application manifest <a href="#install-an-application"><i class="fas fa-external-link-alt" style="color:darkgray;"></i></a>.</p>

<table><thead>
<tr>
<th>Notification type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>cqm.ExConversationChangeNotification</td>
<td>Notification on conversation state changes, e.g. a conversation is created, a participant (customer or agent) has changed, a conversation is closed, or the CSAT score is updated.</td>
</tr>
<tr>
<td>ms.MessagingEventNotification.ContentEvent</td>
<td>Notification on text-based messages in a conversation. This includes messages by all participants, agents <strong>and</strong> customers.</td>
</tr>
<tr>
<td>ms.MessagingEventNotification.RichContentEvent</td>
<td>Notification on messages with Rich Content (a.k.a Structured Content) in a conversation.</td>
</tr>
<tr>
<td>ms.MessagingEventNotification.AcceptStatusEvent</td>
<td>Notification on status events, e.g. a participant accepted or read one to many messages.</td>
</tr>
<tr>
<td>ms.MessagingEventNotification.ChatStateEvent</td>
<td>Notification on the activity state of a participant. For example, the notification indicates whether a participant is composing a message, becomes active or inactive.</td>
</tr>
</tbody></table>

<aside class="success">
The subscription to notification types is defined in the application manifest. You can modify the subscriptions and endpoints by using the Demo Connector <a href="https://connector-api.dev.liveperson.net/" target="_new"><i class="fas fa-external-link-alt" style="color:darkgray;"></i></a>. Please make sure to only modify the application manifest on developer accounts.
</aside>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h2 id='conversation-created'>Conversation created</h2>
<blockquote>
<p>A new conversation is created:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="o">{</span>
   <span class="s2">"kind"</span>:<span class="s2">"notification"</span>,
   <span class="s2">"body"</span>:<span class="o">{</span>
      <span class="s2">"subscriptionId"</span>:<span class="s2">"ea7ecc5a-58c4-4a16-9510-4868bef08d79"</span>,
      <span class="s2">"changes"</span>:[
         <span class="o">{</span>
            <span class="s2">"type"</span>:<span class="s2">"UPSERT"</span>,
            <span class="s2">"result"</span>:<span class="o">{</span>
               <span class="s2">"convId"</span>:<span class="s2">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span>,
               <span class="s2">"effectiveTTR"</span>:1553590349893,
               <span class="s2">"conversationDetails"</span>:<span class="o">{</span>
                  <span class="s2">"skillId"</span>:<span class="s2">"558327413"</span>,
                  <span class="s2">"participants"</span>:[
                     <span class="o">{</span>
                        <span class="s2">"id"</span>:<span class="s2">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span>,
                        <span class="s2">"role"</span>:<span class="s2">"CONSUMER"</span>
                     <span class="o">}</span>
                  <span class="o">]</span>,
                  <span class="s2">"dialogs"</span>:[
                     <span class="o">{</span>
                        <span class="s2">"dialogId"</span>:<span class="s2">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span>,
                        <span class="s2">"participantsDetails"</span>:[
                           <span class="o">{</span>
                              <span class="s2">"id"</span>:<span class="s2">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span>,
                              <span class="s2">"role"</span>:<span class="s2">"CONSUMER"</span>,
                              <span class="s2">"state"</span>:<span class="s2">"ACTIVE"</span>
                           <span class="o">}</span>
                        <span class="o">]</span>,
                        <span class="s2">"dialogType"</span>:<span class="s2">"MAIN"</span>,
                        <span class="s2">"channelType"</span>:<span class="s2">"MESSAGING"</span>,
                        <span class="s2">"state"</span>:<span class="s2">"OPEN"</span>,
                        <span class="s2">"creationTs"</span>:1553589749650,
                        <span class="s2">"metaDataLastUpdateTs"</span>:1553589749650
                     <span class="o">}</span>
                  <span class="o">]</span>,
                  <span class="s2">"brandId"</span>:<span class="s2">"</span><span class="k">${</span><span class="nv">accountId</span><span class="k">}</span><span class="s2">"</span>,
                  <span class="s2">"state"</span>:<span class="s2">"OPEN"</span>,
                  <span class="s2">"stage"</span>:<span class="s2">"OPEN"</span>,
                  <span class="s2">"startTs"</span>:1553589749650,
                  <span class="s2">"metaDataLastUpdateTs"</span>:1553589749650,
                  <span class="s2">"ttr"</span>:<span class="o">{</span>
                     <span class="s2">"ttrType"</span>:<span class="s2">"PRIORITIZED"</span>,
                     <span class="s2">"value"</span>:600
                  <span class="o">}</span>,
                  <span class="s2">"conversationHandlerDetails"</span>:<span class="o">{</span>
                     <span class="s2">"accountId"</span>:<span class="s2">"</span><span class="k">${</span><span class="nv">accountId</span><span class="k">}</span><span class="s2">"</span>,
                     <span class="s2">"skillId"</span>:<span class="s2">"558327413"</span>
                  <span class="o">}</span>
               <span class="o">}</span>
            <span class="o">}</span>
         <span class="o">}</span>
      <span class="o">]</span>
   <span class="o">}</span>,
   <span class="s2">"type"</span>:<span class="s2">"cqm.ExConversationChangeNotification"</span>
<span class="o">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="o">{</span>
   <span class="s">"kind"</span><span class="o">:</span><span class="s">"notification"</span><span class="o">,</span>
   <span class="s">"body"</span><span class="o">:{</span>
      <span class="s">"subscriptionId"</span><span class="o">:</span><span class="s">"ea7ecc5a-58c4-4a16-9510-4868bef08d79"</span><span class="o">,</span>
      <span class="s">"changes"</span><span class="o">:[</span>
         <span class="o">{</span>
            <span class="s">"type"</span><span class="o">:</span><span class="s">"UPSERT"</span><span class="o">,</span>
            <span class="s">"result"</span><span class="o">:{</span>
               <span class="s">"convId"</span><span class="o">:</span><span class="s">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span><span class="o">,</span>
               <span class="s">"effectiveTTR"</span><span class="o">:</span><span class="mi">1553590349893</span><span class="o">,</span>
               <span class="s">"conversationDetails"</span><span class="o">:{</span>
                  <span class="s">"skillId"</span><span class="o">:</span><span class="s">"558327413"</span><span class="o">,</span>
                  <span class="s">"participants"</span><span class="o">:[</span>
                     <span class="o">{</span>
                        <span class="s">"id"</span><span class="o">:</span><span class="s">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span><span class="o">,</span>
                        <span class="s">"role"</span><span class="o">:</span><span class="s">"CONSUMER"</span>
                     <span class="o">}</span>
                  <span class="o">],</span>
                  <span class="s">"dialogs"</span><span class="o">:[</span>
                     <span class="o">{</span>
                        <span class="s">"dialogId"</span><span class="o">:</span><span class="s">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span><span class="o">,</span>
                        <span class="s">"participantsDetails"</span><span class="o">:[</span>
                           <span class="o">{</span>
                              <span class="s">"id"</span><span class="o">:</span><span class="s">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span><span class="o">,</span>
                              <span class="s">"role"</span><span class="o">:</span><span class="s">"CONSUMER"</span><span class="o">,</span>
                              <span class="s">"state"</span><span class="o">:</span><span class="s">"ACTIVE"</span>
                           <span class="o">}</span>
                        <span class="o">],</span>
                        <span class="s">"dialogType"</span><span class="o">:</span><span class="s">"MAIN"</span><span class="o">,</span>
                        <span class="s">"channelType"</span><span class="o">:</span><span class="s">"MESSAGING"</span><span class="o">,</span>
                        <span class="s">"state"</span><span class="o">:</span><span class="s">"OPEN"</span><span class="o">,</span>
                        <span class="s">"creationTs"</span><span class="o">:</span><span class="mi">1553589749650</span><span class="o">,</span>
                        <span class="s">"metaDataLastUpdateTs"</span><span class="o">:</span><span class="mi">1553589749650</span>
                     <span class="o">}</span>
                  <span class="o">],</span>
                  <span class="s">"brandId"</span><span class="o">:</span><span class="s">"${accountId}"</span><span class="o">,</span>
                  <span class="s">"state"</span><span class="o">:</span><span class="s">"OPEN"</span><span class="o">,</span>
                  <span class="s">"stage"</span><span class="o">:</span><span class="s">"OPEN"</span><span class="o">,</span>
                  <span class="s">"startTs"</span><span class="o">:</span><span class="mi">1553589749650</span><span class="o">,</span>
                  <span class="s">"metaDataLastUpdateTs"</span><span class="o">:</span><span class="mi">1553589749650</span><span class="o">,</span>
                  <span class="s">"ttr"</span><span class="o">:{</span>
                     <span class="s">"ttrType"</span><span class="o">:</span><span class="s">"PRIORITIZED"</span><span class="o">,</span>
                     <span class="s">"value"</span><span class="o">:</span><span class="mi">600</span>
                  <span class="o">},</span>
                  <span class="s">"conversationHandlerDetails"</span><span class="o">:{</span>
                     <span class="s">"accountId"</span><span class="o">:</span><span class="s">"${accountId}"</span><span class="o">,</span>
                     <span class="s">"skillId"</span><span class="o">:</span><span class="s">"558327413"</span>
                  <span class="o">}</span>
               <span class="o">}</span>
            <span class="o">}</span>
         <span class="o">}</span>
      <span class="o">]</span>
   <span class="o">},</span>
   <span class="s">"type"</span><span class="o">:</span><span class="s">"cqm.ExConversationChangeNotification"</span>
<span class="o">}</span>
</code></pre>
<p>If the application subscribes to <code>ExConversationChangeNotification</code> events, the webhook endpoint receives the following payload after a conversation was successfully created.</p>

<table><thead>
<tr>
<th>Name</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>kind</td>
<td>notification</td>
<td>Defines payload as &#39;notification&#39;</td>
</tr>
<tr>
<td>type</td>
<td>cqm.ExConversationChangeNotification</td>
<td>Describes the type of notification</td>
</tr>
<tr>
<td>body</td>
<td>changes</td>
<td>Changes as an array of state updates</td>
</tr>
<tr>
<td>convId</td>
<td><em>uuid</em></td>
<td>The unique identifier of the conversation. The value equals the dialogId value with dialogType MAIN defined within the same object</td>
</tr>
<tr>
<td>stage</td>
<td>OPEN</td>
<td>Defines the inital state of the conversation as <em>OPEN</em></td>
</tr>
</tbody></table>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h2 id='agent-joined'>Agent joined</h2>
<blockquote>
<p>Agent is added as a new participant to the conversation:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="o">{</span>
   <span class="s2">"kind"</span>:<span class="s2">"notification"</span>,
   <span class="s2">"body"</span>:<span class="o">{</span>
      <span class="s2">"subscriptionId"</span>:<span class="s2">"ea7ecc5a-58c4-4a16-9510-4868bef08d79"</span>,
      <span class="s2">"changes"</span>:[
         <span class="o">{</span>
            <span class="s2">"type"</span>:<span class="s2">"UPSERT"</span>,
            <span class="s2">"result"</span>:<span class="o">{</span>
               <span class="s2">"convId"</span>:<span class="s2">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span>,
               <span class="s2">"effectiveTTR"</span>:1553590349893,
               <span class="s2">"conversationDetails"</span>:<span class="o">{</span>
                  <span class="s2">"skillId"</span>:<span class="s2">"558327413"</span>,
                  <span class="s2">"participants"</span>:[
                     <span class="o">{</span>
                        <span class="s2">"id"</span>:<span class="s2">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span>,
                        <span class="s2">"role"</span>:<span class="s2">"CONSUMER"</span>
                     <span class="o">}</span>,
                     <span class="o">{</span>
                        <span class="s2">"id"</span>:<span class="s2">"e9b2867c-f984-5727-b034-fc9c6800bd9c"</span>,
                        <span class="s2">"role"</span>:<span class="s2">"ASSIGNED_AGENT"</span>
                     <span class="o">}</span>
                  <span class="o">]</span>,
                  <span class="s2">"dialogs"</span>:[
                     <span class="o">{</span>
                        <span class="s2">"dialogId"</span>:<span class="s2">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span>,
                        <span class="s2">"participantsDetails"</span>:[
                           <span class="o">{</span>
                              <span class="s2">"id"</span>:<span class="s2">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span>,
                              <span class="s2">"role"</span>:<span class="s2">"CONSUMER"</span>,
                              <span class="s2">"state"</span>:<span class="s2">"ACTIVE"</span>
                           <span class="o">}</span>,
                           <span class="o">{</span>
                              <span class="s2">"id"</span>:<span class="s2">"e9b2867c-f984-5727-b034-fc9c6800bd9c"</span>,
                              <span class="s2">"role"</span>:<span class="s2">"ASSIGNED_AGENT"</span>,
                              <span class="s2">"state"</span>:<span class="s2">"ACTIVE"</span>
                           <span class="o">}</span>
                        <span class="o">]</span>,
                        <span class="s2">"dialogType"</span>:<span class="s2">"MAIN"</span>,
                        <span class="s2">"channelType"</span>:<span class="s2">"MESSAGING"</span>,
                        <span class="s2">"state"</span>:<span class="s2">"OPEN"</span>,
                        <span class="s2">"creationTs"</span>:1553589749650,
                        <span class="s2">"metaDataLastUpdateTs"</span>:1553589749650
                     <span class="o">}</span>
                  <span class="o">]</span>,
                  <span class="s2">"brandId"</span>:<span class="s2">"</span><span class="k">${</span><span class="nv">accountId</span><span class="k">}</span><span class="s2">"</span>,
                  <span class="s2">"state"</span>:<span class="s2">"OPEN"</span>,
                  <span class="s2">"stage"</span>:<span class="s2">"OPEN"</span>,
                  <span class="s2">"startTs"</span>:1553589749650,
                  <span class="s2">"metaDataLastUpdateTs"</span>:1553590954025,
                  <span class="s2">"ttr"</span>:<span class="o">{</span>
                     <span class="s2">"ttrType"</span>:<span class="s2">"PRIORITIZED"</span>,
                     <span class="s2">"value"</span>:600
                  <span class="o">}</span>,
                  <span class="s2">"conversationHandlerDetails"</span>:<span class="o">{</span>
                     <span class="s2">"accountId"</span>:<span class="s2">"</span><span class="k">${</span><span class="nv">accountId</span><span class="k">}</span><span class="s2">"</span>,
                     <span class="s2">"skillId"</span>:<span class="s2">"558327413"</span>
                  <span class="o">}</span>
               <span class="o">}</span>
            <span class="o">}</span>
         <span class="o">}</span>
      <span class="o">]</span>
   <span class="o">}</span>,
   <span class="s2">"type"</span>:<span class="s2">"cqm.ExConversationChangeNotification"</span>
<span class="o">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="o">{</span>
   <span class="s">"kind"</span><span class="o">:</span><span class="s">"notification"</span><span class="o">,</span>
   <span class="s">"body"</span><span class="o">:{</span>
      <span class="s">"subscriptionId"</span><span class="o">:</span><span class="s">"ea7ecc5a-58c4-4a16-9510-4868bef08d79"</span><span class="o">,</span>
      <span class="s">"changes"</span><span class="o">:[</span>
         <span class="o">{</span>
            <span class="s">"type"</span><span class="o">:</span><span class="s">"UPSERT"</span><span class="o">,</span>
            <span class="s">"result"</span><span class="o">:{</span>
               <span class="s">"convId"</span><span class="o">:</span><span class="s">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span><span class="o">,</span>
               <span class="s">"effectiveTTR"</span><span class="o">:</span><span class="mi">1553590349893</span><span class="o">,</span>
               <span class="s">"conversationDetails"</span><span class="o">:{</span>
                  <span class="s">"skillId"</span><span class="o">:</span><span class="s">"558327413"</span><span class="o">,</span>
                  <span class="s">"participants"</span><span class="o">:[</span>
                     <span class="o">{</span>
                        <span class="s">"id"</span><span class="o">:</span><span class="s">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span><span class="o">,</span>
                        <span class="s">"role"</span><span class="o">:</span><span class="s">"CONSUMER"</span>
                     <span class="o">},</span>
                     <span class="o">{</span>
                        <span class="s">"id"</span><span class="o">:</span><span class="s">"e9b2867c-f984-5727-b034-fc9c6800bd9c"</span><span class="o">,</span>
                        <span class="s">"role"</span><span class="o">:</span><span class="s">"ASSIGNED_AGENT"</span>
                     <span class="o">}</span>
                  <span class="o">],</span>
                  <span class="s">"dialogs"</span><span class="o">:[</span>
                     <span class="o">{</span>
                        <span class="s">"dialogId"</span><span class="o">:</span><span class="s">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span><span class="o">,</span>
                        <span class="s">"participantsDetails"</span><span class="o">:[</span>
                           <span class="o">{</span>
                              <span class="s">"id"</span><span class="o">:</span><span class="s">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span><span class="o">,</span>
                              <span class="s">"role"</span><span class="o">:</span><span class="s">"CONSUMER"</span><span class="o">,</span>
                              <span class="s">"state"</span><span class="o">:</span><span class="s">"ACTIVE"</span>
                           <span class="o">},</span>
                           <span class="o">{</span>
                              <span class="s">"id"</span><span class="o">:</span><span class="s">"e9b2867c-f984-5727-b034-fc9c6800bd9c"</span><span class="o">,</span>
                              <span class="s">"role"</span><span class="o">:</span><span class="s">"ASSIGNED_AGENT"</span><span class="o">,</span>
                              <span class="s">"state"</span><span class="o">:</span><span class="s">"ACTIVE"</span>
                           <span class="o">}</span>
                        <span class="o">],</span>
                        <span class="s">"dialogType"</span><span class="o">:</span><span class="s">"MAIN"</span><span class="o">,</span>
                        <span class="s">"channelType"</span><span class="o">:</span><span class="s">"MESSAGING"</span><span class="o">,</span>
                        <span class="s">"state"</span><span class="o">:</span><span class="s">"OPEN"</span><span class="o">,</span>
                        <span class="s">"creationTs"</span><span class="o">:</span><span class="mi">1553589749650</span><span class="o">,</span>
                        <span class="s">"metaDataLastUpdateTs"</span><span class="o">:</span><span class="mi">1553589749650</span>
                     <span class="o">}</span>
                  <span class="o">],</span>
                  <span class="s">"brandId"</span><span class="o">:</span><span class="s">"${accountId}"</span><span class="o">,</span>
                  <span class="s">"state"</span><span class="o">:</span><span class="s">"OPEN"</span><span class="o">,</span>
                  <span class="s">"stage"</span><span class="o">:</span><span class="s">"OPEN"</span><span class="o">,</span>
                  <span class="s">"startTs"</span><span class="o">:</span><span class="mi">1553589749650</span><span class="o">,</span>
                  <span class="s">"metaDataLastUpdateTs"</span><span class="o">:</span><span class="mi">1553590954025</span><span class="o">,</span>
                  <span class="s">"ttr"</span><span class="o">:{</span>
                     <span class="s">"ttrType"</span><span class="o">:</span><span class="s">"PRIORITIZED"</span><span class="o">,</span>
                     <span class="s">"value"</span><span class="o">:</span><span class="mi">600</span>
                  <span class="o">},</span>
                  <span class="s">"conversationHandlerDetails"</span><span class="o">:{</span>
                     <span class="s">"accountId"</span><span class="o">:</span><span class="s">"${accountId}"</span><span class="o">,</span>
                     <span class="s">"skillId"</span><span class="o">:</span><span class="s">"558327413"</span>
                  <span class="o">}</span>
               <span class="o">}</span>
            <span class="o">}</span>
         <span class="o">}</span>
      <span class="o">]</span>
   <span class="o">},</span>
   <span class="s">"type"</span><span class="o">:</span><span class="s">"cqm.ExConversationChangeNotification"</span>
<span class="o">}</span>
</code></pre>
<p>When an agent joins a conversation, this triggers an <code>cqm.ExConversationChangeNotification</code> update. </p>

<table><thead>
<tr>
<th>Name</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>kind</td>
<td>notification</td>
<td>Defines payload as &#39;notification&#39;</td>
</tr>
<tr>
<td>type</td>
<td>cqm.ExConversationChangeNotification</td>
<td>Describes the type of notification</td>
</tr>
<tr>
<td>body</td>
<td>changes</td>
<td>Changes as an array of state updates</td>
</tr>
<tr>
<td>stage</td>
<td>OPEN</td>
<td>Defines the inital state of the conversation as <em>OPEN</em></td>
</tr>
<tr>
<td>participants</td>
<td><em>ARRAY</em></td>
<td>Adds a participant with the role ASSIGNED_AGENT, AGENT_MANAGER, or ASSIGNED_MANAGER. Other possible roles are CONSUMER, READER, and CONTROLLER.</td>
</tr>
</tbody></table>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h2 id='message-by-agent'>Message by agent</h2>
<blockquote>
<p>Agent sends text message</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="o">{</span>
   <span class="s2">"kind"</span>:<span class="s2">"notification"</span>,
   <span class="s2">"body"</span>:<span class="o">{</span>
      <span class="s2">"changes"</span>:[
         <span class="o">{</span>
            <span class="s2">"sequence"</span>:5,
            <span class="s2">"originatorId"</span>:<span class="s2">"e9b2867c-f984-5727-b034-fc9c6800bd9c"</span>,
            <span class="s2">"originatorMetadata"</span>:<span class="o">{</span>
               <span class="s2">"id"</span>:<span class="s2">"e9b2867c-f984-5727-b034-fc9c6800bd9c"</span>,
               <span class="s2">"role"</span>:<span class="s2">"ASSIGNED_AGENT"</span>
            <span class="o">}</span>,
            <span class="s2">"serverTimestamp"</span>:1553593406049,
            <span class="s2">"event"</span>:<span class="o">{</span>
               <span class="s2">"type"</span>:<span class="s2">"ContentEvent"</span>,
               <span class="s2">"message"</span>:<span class="s2">"This is a reply!"</span>,
               <span class="s2">"contentType"</span>:<span class="s2">"text/plain"</span>
            <span class="o">}</span>,
            <span class="s2">"conversationId"</span>:<span class="s2">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span>,
            <span class="s2">"dialogId"</span>:<span class="s2">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span>
         <span class="o">}</span>
      <span class="o">]</span>
   <span class="o">}</span>,
   <span class="s2">"type"</span>:<span class="s2">"ms.MessagingEventNotification"</span>
<span class="o">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="o">{</span>
   <span class="s">"kind"</span><span class="o">:</span><span class="s">"notification"</span><span class="o">,</span>
   <span class="s">"body"</span><span class="o">:{</span>
      <span class="s">"changes"</span><span class="o">:[</span>
         <span class="o">{</span>
            <span class="s">"sequence"</span><span class="o">:</span><span class="mi">5</span><span class="o">,</span>
            <span class="s">"originatorId"</span><span class="o">:</span><span class="s">"e9b2867c-f984-5727-b034-fc9c6800bd9c"</span><span class="o">,</span>
            <span class="s">"originatorMetadata"</span><span class="o">:{</span>
               <span class="s">"id"</span><span class="o">:</span><span class="s">"e9b2867c-f984-5727-b034-fc9c6800bd9c"</span><span class="o">,</span>
               <span class="s">"role"</span><span class="o">:</span><span class="s">"ASSIGNED_AGENT"</span>
            <span class="o">},</span>
            <span class="s">"serverTimestamp"</span><span class="o">:</span><span class="mi">1553593406049</span><span class="o">,</span>
            <span class="s">"event"</span><span class="o">:{</span>
               <span class="s">"type"</span><span class="o">:</span><span class="s">"ContentEvent"</span><span class="o">,</span>
               <span class="s">"message"</span><span class="o">:</span><span class="s">"This is a reply!"</span><span class="o">,</span>
               <span class="s">"contentType"</span><span class="o">:</span><span class="s">"text/plain"</span>
            <span class="o">},</span>
            <span class="s">"conversationId"</span><span class="o">:</span><span class="s">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span><span class="o">,</span>
            <span class="s">"dialogId"</span><span class="o">:</span><span class="s">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span>
         <span class="o">}</span>
      <span class="o">]</span>
   <span class="o">},</span>
   <span class="s">"type"</span><span class="o">:</span><span class="s">"ms.MessagingEventNotification"</span>
<span class="o">}</span>
</code></pre>
<p>When an agent sends a message to a conversation, a <code>ms.MessagingEventNotification</code> is triggered.</p>

<table><thead>
<tr>
<th>Name</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>kind</td>
<td>notification</td>
<td>Defines payload as &#39;notification&#39;</td>
</tr>
<tr>
<td>type</td>
<td>ms.MessagingEventNotification</td>
<td>Describes the type of notification</td>
</tr>
<tr>
<td>body</td>
<td>changes</td>
<td>Changes as an array of state updates</td>
</tr>
<tr>
<td>sequence</td>
<td><em>NUM VALUE</em></td>
<td>The sequence number of this message in this conversation</td>
</tr>
<tr>
<td>originatorId</td>
<td><em>UUID</em></td>
<td>The originator of this message update</td>
</tr>
<tr>
<td>event.type</td>
<td>ContentEvent</td>
<td>The type of the event</td>
</tr>
<tr>
<td>event.contentType</td>
<td>text/plain</td>
<td>Content type of the event</td>
</tr>
<tr>
<td>event.message</td>
<td><em>STRING VALUE</em></td>
<td>The actual message content</td>
</tr>
<tr>
<td>conversationId</td>
<td><em>UUID</em></td>
<td>The unique identifier of the conversation</td>
</tr>
<tr>
<td>dialogId</td>
<td><em>UUID</em></td>
<td>The unique identifier of the dialog in which the message was sent. Implicitly, dialogId and conversationId are the same for the <em>MAIN</em> dialog.</td>
</tr>
</tbody></table>

<aside class="success">
A customer can be the originator of a message, and should hence be filtered from being displayed. For this it is required to know the participantId of the customer.
</aside>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h2 id='skill-transfer'>Skill transfer</h2>
<blockquote>
<p>Conversation is transferred to another skill:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code><span class="o">{</span>
   <span class="s2">"kind"</span>:<span class="s2">"notification"</span>,
   <span class="s2">"body"</span>:<span class="o">{</span>
      <span class="s2">"subscriptionId"</span>:<span class="s2">"ea7ecc5a-58c4-4a16-9510-4868bef08d79"</span>,
      <span class="s2">"changes"</span>:[
         <span class="o">{</span>
            <span class="s2">"type"</span>:<span class="s2">"UPSERT"</span>,
            <span class="s2">"result"</span>:<span class="o">{</span>
               <span class="s2">"convId"</span>:<span class="s2">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span>,
               <span class="s2">"effectiveTTR"</span>:1553598420199,
               <span class="s2">"conversationDetails"</span>:<span class="o">{</span>
                  <span class="s2">"skillId"</span>:<span class="s2">"99999999"</span>,
                  <span class="s2">"participants"</span>:[
                     <span class="o">{</span>
                        <span class="s2">"id"</span>:<span class="s2">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span>,
                        <span class="s2">"role"</span>:<span class="s2">"CONSUMER"</span>
                     <span class="o">}</span>
                  <span class="o">]</span>,
                  <span class="s2">"dialogs"</span>:[
                     <span class="o">{</span>
                        <span class="s2">"dialogId"</span>:<span class="s2">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span>,
                        <span class="s2">"participantsDetails"</span>:[
                           <span class="o">{</span>
                              <span class="s2">"id"</span>:<span class="s2">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span>,
                              <span class="s2">"role"</span>:<span class="s2">"CONSUMER"</span>,
                              <span class="s2">"state"</span>:<span class="s2">"ACTIVE"</span>
                           <span class="o">}</span>
                        <span class="o">]</span>,
                        <span class="s2">"dialogType"</span>:<span class="s2">"MAIN"</span>,
                        <span class="s2">"channelType"</span>:<span class="s2">"MESSAGING"</span>,
                        <span class="s2">"state"</span>:<span class="s2">"OPEN"</span>,
                        <span class="s2">"creationTs"</span>:1553589749650,
                        <span class="s2">"metaDataLastUpdateTs"</span>:1553589749650
                     <span class="o">}</span>
                  <span class="o">]</span>,
                  <span class="s2">"brandId"</span>:<span class="s2">"</span><span class="k">${</span><span class="nv">accountId</span><span class="k">}</span><span class="s2">"</span>,
                  <span class="s2">"state"</span>:<span class="s2">"OPEN"</span>,
                  <span class="s2">"stage"</span>:<span class="s2">"OPEN"</span>,
                  <span class="s2">"startTs"</span>:1553589749650,
                  <span class="s2">"metaDataLastUpdateTs"</span>:1553597820083,
                  <span class="s2">"ttr"</span>:<span class="o">{</span>
                     <span class="s2">"ttrType"</span>:<span class="s2">"PRIORITIZED"</span>,
                     <span class="s2">"value"</span>:600
                  <span class="o">}</span>,
                  <span class="s2">"conversationHandlerDetails"</span>:<span class="o">{</span>
                     <span class="s2">"accountId"</span>:<span class="s2">"</span><span class="k">${</span><span class="nv">accountId</span><span class="k">}</span><span class="s2">"</span>,
                     <span class="s2">"skillId"</span>:<span class="s2">"99999999"</span>
                  <span class="o">}</span>
               <span class="o">}</span>
            <span class="o">}</span>
         <span class="o">}</span>
      <span class="o">]</span>
   <span class="o">}</span>,
   <span class="s2">"type"</span>:<span class="s2">"cqm.ExConversationChangeNotification"</span>
<span class="o">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="o">{</span>
   <span class="s">"kind"</span><span class="o">:</span><span class="s">"notification"</span><span class="o">,</span>
   <span class="s">"body"</span><span class="o">:{</span>
      <span class="s">"subscriptionId"</span><span class="o">:</span><span class="s">"ea7ecc5a-58c4-4a16-9510-4868bef08d79"</span><span class="o">,</span>
      <span class="s">"changes"</span><span class="o">:[</span>
         <span class="o">{</span>
            <span class="s">"type"</span><span class="o">:</span><span class="s">"UPSERT"</span><span class="o">,</span>
            <span class="s">"result"</span><span class="o">:{</span>
               <span class="s">"convId"</span><span class="o">:</span><span class="s">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span><span class="o">,</span>
               <span class="s">"effectiveTTR"</span><span class="o">:</span><span class="mi">1553598420199</span><span class="o">,</span>
               <span class="s">"conversationDetails"</span><span class="o">:{</span>
                  <span class="s">"skillId"</span><span class="o">:</span><span class="s">"99999999"</span><span class="o">,</span>
                  <span class="s">"participants"</span><span class="o">:[</span>
                     <span class="o">{</span>
                        <span class="s">"id"</span><span class="o">:</span><span class="s">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span><span class="o">,</span>
                        <span class="s">"role"</span><span class="o">:</span><span class="s">"CONSUMER"</span>
                     <span class="o">}</span>
                  <span class="o">],</span>
                  <span class="s">"dialogs"</span><span class="o">:[</span>
                     <span class="o">{</span>
                        <span class="s">"dialogId"</span><span class="o">:</span><span class="s">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span><span class="o">,</span>
                        <span class="s">"participantsDetails"</span><span class="o">:[</span>
                           <span class="o">{</span>
                              <span class="s">"id"</span><span class="o">:</span><span class="s">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span><span class="o">,</span>
                              <span class="s">"role"</span><span class="o">:</span><span class="s">"CONSUMER"</span><span class="o">,</span>
                              <span class="s">"state"</span><span class="o">:</span><span class="s">"ACTIVE"</span>
                           <span class="o">}</span>
                        <span class="o">],</span>
                        <span class="s">"dialogType"</span><span class="o">:</span><span class="s">"MAIN"</span><span class="o">,</span>
                        <span class="s">"channelType"</span><span class="o">:</span><span class="s">"MESSAGING"</span><span class="o">,</span>
                        <span class="s">"state"</span><span class="o">:</span><span class="s">"OPEN"</span><span class="o">,</span>
                        <span class="s">"creationTs"</span><span class="o">:</span><span class="mi">1553589749650</span><span class="o">,</span>
                        <span class="s">"metaDataLastUpdateTs"</span><span class="o">:</span><span class="mi">1553589749650</span>
                     <span class="o">}</span>
                  <span class="o">],</span>
                  <span class="s">"brandId"</span><span class="o">:</span><span class="s">"${accountId}"</span><span class="o">,</span>
                  <span class="s">"state"</span><span class="o">:</span><span class="s">"OPEN"</span><span class="o">,</span>
                  <span class="s">"stage"</span><span class="o">:</span><span class="s">"OPEN"</span><span class="o">,</span>
                  <span class="s">"startTs"</span><span class="o">:</span><span class="mi">1553589749650</span><span class="o">,</span>
                  <span class="s">"metaDataLastUpdateTs"</span><span class="o">:</span><span class="mi">1553597820083</span><span class="o">,</span>
                  <span class="s">"ttr"</span><span class="o">:{</span>
                     <span class="s">"ttrType"</span><span class="o">:</span><span class="s">"PRIORITIZED"</span><span class="o">,</span>
                     <span class="s">"value"</span><span class="o">:</span><span class="mi">600</span>
                  <span class="o">},</span>
                  <span class="s">"conversationHandlerDetails"</span><span class="o">:{</span>
                     <span class="s">"accountId"</span><span class="o">:</span><span class="s">"${accountId}"</span><span class="o">,</span>
                     <span class="s">"skillId"</span><span class="o">:</span><span class="s">"99999999"</span>
                  <span class="o">}</span>
               <span class="o">}</span>
            <span class="o">}</span>
         <span class="o">}</span>
      <span class="o">]</span>
   <span class="o">},</span>
   <span class="s">"type"</span><span class="o">:</span><span class="s">"cqm.ExConversationChangeNotification"</span>
<span class="o">}</span>
</code></pre>
<p>A skill transfer consists of two state changes in the notification: the agent is removed as a participant and the skill id is updated.</p>

<table><thead>
<tr>
<th>Name</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>kind</td>
<td>notification</td>
<td>Defines payload as &#39;notification&#39;</td>
</tr>
<tr>
<td>type</td>
<td>cqm.ExConversationChangeNotification</td>
<td>Describes the type of notification</td>
</tr>
<tr>
<td>body</td>
<td>changes</td>
<td>Changes as an array of state updates</td>
</tr>
<tr>
<td>conversationId</td>
<td><em>UUID</em></td>
<td>The unique identifier of the conversation</td>
</tr>
<tr>
<td>skillId</td>
<td><em>NUM VALUE</em></td>
<td>The updated skill id</td>
</tr>
<tr>
<td>participants</td>
<td><em>ARRAY</em></td>
<td>The updated list of participants. In this case, the participant list only includes the consumer because the agent is removed as a participant as part of the transfer</td>
</tr>
</tbody></table>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<h2 id='conversation-closed-by-agent'>Conversation closed by agent</h2><pre class="highlight shell tab-shell"><code><span class="o">{</span>
   <span class="s2">"kind"</span>:<span class="s2">"notification"</span>,
   <span class="s2">"body"</span>:<span class="o">{</span>
      <span class="s2">"subscriptionId"</span>:<span class="s2">"0ce06a28-455d-4a31-81f1-e3a9de585e43"</span>,
      <span class="s2">"changes"</span>:[
         <span class="o">{</span>
            <span class="s2">"type"</span>:<span class="s2">"UPSERT"</span>,
            <span class="s2">"result"</span>:<span class="o">{</span>
               <span class="s2">"convId"</span>:<span class="s2">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span>,
               <span class="s2">"effectiveTTR"</span>:-1,
               <span class="s2">"conversationDetails"</span>:<span class="o">{</span>
                  <span class="s2">"skillId"</span>:<span class="s2">"558327413"</span>,
                  <span class="s2">"participants"</span>:[
                     <span class="o">{</span>
                        <span class="s2">"id"</span>:<span class="s2">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span>,
                        <span class="s2">"role"</span>:<span class="s2">"CONSUMER"</span>
                     <span class="o">}</span>,
                     <span class="o">{</span>
                        <span class="s2">"id"</span>:<span class="s2">"e9b2867c-f984-5727-b034-fc9c6800bd9c"</span>,
                        <span class="s2">"role"</span>:<span class="s2">"ASSIGNED_AGENT"</span>
                     <span class="o">}</span>
                  <span class="o">]</span>,
                  <span class="s2">"dialogs"</span>:[
                     <span class="o">{</span>
                        <span class="s2">"dialogId"</span>:<span class="s2">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span>,
                        <span class="s2">"participantsDetails"</span>:[
                           <span class="o">{</span>
                              <span class="s2">"id"</span>:<span class="s2">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span>,
                              <span class="s2">"role"</span>:<span class="s2">"CONSUMER"</span>,
                              <span class="s2">"state"</span>:<span class="s2">"ACTIVE"</span>
                           <span class="o">}</span>,
                           <span class="o">{</span>
                              <span class="s2">"id"</span>:<span class="s2">"e9b2867c-f984-5727-b034-fc9c6800bd9c"</span>,
                              <span class="s2">"role"</span>:<span class="s2">"ASSIGNED_AGENT"</span>,
                              <span class="s2">"state"</span>:<span class="s2">"ACTIVE"</span>
                           <span class="o">}</span>
                        <span class="o">]</span>,
                        <span class="s2">"dialogType"</span>:<span class="s2">"MAIN"</span>,
                        <span class="s2">"channelType"</span>:<span class="s2">"MESSAGING"</span>,
                        <span class="s2">"state"</span>:<span class="s2">"CLOSE"</span>,
                        <span class="s2">"creationTs"</span>:1553589749650,
                        <span class="s2">"endTs"</span>:1553599771074,
                        <span class="s2">"metaDataLastUpdateTs"</span>:1553599771074,
                        <span class="s2">"closedBy"</span>:<span class="s2">"AGENT"</span>
                     <span class="o">}</span>
                  <span class="o">]</span>,
                  <span class="s2">"brandId"</span>:<span class="s2">"5313846"</span>,
                  <span class="s2">"state"</span>:<span class="s2">"CLOSE"</span>,
                  <span class="s2">"stage"</span>:<span class="s2">"CLOSE"</span>,
                  <span class="s2">"closeReason"</span>:<span class="s2">"AGENT"</span>,
                  <span class="s2">"startTs"</span>:1553589749650,
                  <span class="s2">"metaDataLastUpdateTs"</span>:1553599771074,
                  <span class="s2">"ttr"</span>:<span class="o">{</span>
                     <span class="s2">"ttrType"</span>:<span class="s2">"PRIORITIZED"</span>,
                     <span class="s2">"value"</span>:600
                  <span class="o">}</span>,
                  <span class="s2">"conversationHandlerDetails"</span>:<span class="o">{</span>
                     <span class="s2">"accountId"</span>:<span class="s2">"5313846"</span>,
                     <span class="s2">"skillId"</span>:<span class="s2">"558327413"</span>
                  <span class="o">}</span>
               <span class="o">}</span>
            <span class="o">}</span>
         <span class="o">}</span>
      <span class="o">]</span>
   <span class="o">}</span>,
   <span class="s2">"type"</span>:<span class="s2">"cqm.ExConversationChangeNotification"</span>
<span class="o">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="o">{</span>
   <span class="s">"kind"</span><span class="o">:</span><span class="s">"notification"</span><span class="o">,</span>
   <span class="s">"body"</span><span class="o">:{</span>
      <span class="s">"subscriptionId"</span><span class="o">:</span><span class="s">"0ce06a28-455d-4a31-81f1-e3a9de585e43"</span><span class="o">,</span>
      <span class="s">"changes"</span><span class="o">:[</span>
         <span class="o">{</span>
            <span class="s">"type"</span><span class="o">:</span><span class="s">"UPSERT"</span><span class="o">,</span>
            <span class="s">"result"</span><span class="o">:{</span>
               <span class="s">"convId"</span><span class="o">:</span><span class="s">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span><span class="o">,</span>
               <span class="s">"effectiveTTR"</span><span class="o">:-</span><span class="mi">1</span><span class="o">,</span>
               <span class="s">"conversationDetails"</span><span class="o">:{</span>
                  <span class="s">"skillId"</span><span class="o">:</span><span class="s">"558327413"</span><span class="o">,</span>
                  <span class="s">"participants"</span><span class="o">:[</span>
                     <span class="o">{</span>
                        <span class="s">"id"</span><span class="o">:</span><span class="s">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span><span class="o">,</span>
                        <span class="s">"role"</span><span class="o">:</span><span class="s">"CONSUMER"</span>
                     <span class="o">},</span>
                     <span class="o">{</span>
                        <span class="s">"id"</span><span class="o">:</span><span class="s">"e9b2867c-f984-5727-b034-fc9c6800bd9c"</span><span class="o">,</span>
                        <span class="s">"role"</span><span class="o">:</span><span class="s">"ASSIGNED_AGENT"</span>
                     <span class="o">}</span>
                  <span class="o">],</span>
                  <span class="s">"dialogs"</span><span class="o">:[</span>
                     <span class="o">{</span>
                        <span class="s">"dialogId"</span><span class="o">:</span><span class="s">"f2384f56-57d5-4087-bd47-8df0ec3102f6"</span><span class="o">,</span>
                        <span class="s">"participantsDetails"</span><span class="o">:[</span>
                           <span class="o">{</span>
                              <span class="s">"id"</span><span class="o">:</span><span class="s">"5b0f3b3574c1a8eb71aebf79cf437cb3f6010b9a6df94771c22e5c637285f5f2"</span><span class="o">,</span>
                              <span class="s">"role"</span><span class="o">:</span><span class="s">"CONSUMER"</span><span class="o">,</span>
                              <span class="s">"state"</span><span class="o">:</span><span class="s">"ACTIVE"</span>
                           <span class="o">},</span>
                           <span class="o">{</span>
                              <span class="s">"id"</span><span class="o">:</span><span class="s">"e9b2867c-f984-5727-b034-fc9c6800bd9c"</span><span class="o">,</span>
                              <span class="s">"role"</span><span class="o">:</span><span class="s">"ASSIGNED_AGENT"</span><span class="o">,</span>
                              <span class="s">"state"</span><span class="o">:</span><span class="s">"ACTIVE"</span>
                           <span class="o">}</span>
                        <span class="o">],</span>
                        <span class="s">"dialogType"</span><span class="o">:</span><span class="s">"MAIN"</span><span class="o">,</span>
                        <span class="s">"channelType"</span><span class="o">:</span><span class="s">"MESSAGING"</span><span class="o">,</span>
                        <span class="s">"state"</span><span class="o">:</span><span class="s">"CLOSE"</span><span class="o">,</span>
                        <span class="s">"creationTs"</span><span class="o">:</span><span class="mi">1553589749650</span><span class="o">,</span>
                        <span class="s">"endTs"</span><span class="o">:</span><span class="mi">1553599771074</span><span class="o">,</span>
                        <span class="s">"metaDataLastUpdateTs"</span><span class="o">:</span><span class="mi">1553599771074</span><span class="o">,</span>
                        <span class="s">"closedBy"</span><span class="o">:</span><span class="s">"AGENT"</span>
                     <span class="o">}</span>
                  <span class="o">],</span>
                  <span class="s">"brandId"</span><span class="o">:</span><span class="s">"5313846"</span><span class="o">,</span>
                  <span class="s">"state"</span><span class="o">:</span><span class="s">"CLOSE"</span><span class="o">,</span>
                  <span class="s">"stage"</span><span class="o">:</span><span class="s">"CLOSE"</span><span class="o">,</span>
                  <span class="s">"closeReason"</span><span class="o">:</span><span class="s">"AGENT"</span><span class="o">,</span>
                  <span class="s">"startTs"</span><span class="o">:</span><span class="mi">1553589749650</span><span class="o">,</span>
                  <span class="s">"metaDataLastUpdateTs"</span><span class="o">:</span><span class="mi">1553599771074</span><span class="o">,</span>
                  <span class="s">"ttr"</span><span class="o">:{</span>
                     <span class="s">"ttrType"</span><span class="o">:</span><span class="s">"PRIORITIZED"</span><span class="o">,</span>
                     <span class="s">"value"</span><span class="o">:</span><span class="mi">600</span>
                  <span class="o">},</span>
                  <span class="s">"conversationHandlerDetails"</span><span class="o">:{</span>
                     <span class="s">"accountId"</span><span class="o">:</span><span class="s">"5313846"</span><span class="o">,</span>
                     <span class="s">"skillId"</span><span class="o">:</span><span class="s">"558327413"</span>
                  <span class="o">}</span>
               <span class="o">}</span>
            <span class="o">}</span>
         <span class="o">}</span>
      <span class="o">]</span>
   <span class="o">},</span>
   <span class="s">"type"</span><span class="o">:</span><span class="s">"cqm.ExConversationChangeNotification"</span>
<span class="o">}</span>
</code></pre>
<table><thead>
<tr>
<th>Name</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>kind</td>
<td>notification</td>
<td>Defines payload as &#39;notification&#39;</td>
</tr>
<tr>
<td>type</td>
<td>cqm.ExConversationChangeNotification</td>
<td>Describes the type of notification</td>
</tr>
<tr>
<td>body</td>
<td>changes</td>
<td>Changes as an array of state updates</td>
</tr>
<tr>
<td>conversationId</td>
<td><em>UUID</em></td>
<td>The unique identifier of the conversation</td>
</tr>
<tr>
<td>stage</td>
<td>CLOSED</td>
<td>Defines the state of the conversation as <em>CLOSED</em></td>
</tr>
<tr>
<td>participants</td>
<td><em>ARRAY</em></td>
<td>The updated list of participants. In this case, the participant list only includes the consumer because the agent is removed as a participant as part of the transfer</td>
</tr>
</tbody></table>

<aside class="warning">
If your connector should work with post conversation surveys, it must support the multi-dialog client feature and track not only conversation but also dialog state changes <a href="https://developers.liveperson.com/messaging-window-api-tutorials-post-conversation-survey-pcs.html#multi-dialog-conversation" target="_new"><i class="fas fa-external-link-alt" style="color:darkgray;"></i></a>.
</aside>

<p><br/>Was this section helpful?&emsp; <a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(1)">Yes</a>&emsp;<a href="javascript:void(0)"onClick="lpDevAssist.sendFeedbackSimple(0)">No</a></p>
<script type="application/javascript">
    var Tooltips = document.getElementsByClassName('TooltipTrigger');
    for (var i = 0; i < Tooltips.length; i++) {
      Tooltips[i].addEventListener("mouseenter", function(ev) {
        ev.preventDefault();
        this.style.position = "relative";
        this.innerHTML = this.innerHTML + "<div class='Tooltips'><p class='" + this.getAttribute("data-position") + "'>" + this.getAttribute("data-tooltips") + "</p></div>";
      });
      Tooltips[i].addEventListener("mouseleave", function(ev) {
        ev.preventDefault();
        this.removeAttribute("style");
        this.innerHTML = this.innerHTML.replace(/<div[^]*?<\/div>/, '');;
      });
    }  
</script>

<!-- BEGIN LivePerson Monitor. --> 

<script type="text/javascript">window.lpTag=window.lpTag||{},'undefined'==typeof window.lpTag._tagCount?(window.lpTag={wl:lpTag.wl||null,scp:lpTag.scp||null,site:'5313846'||'',section:lpTag.section||'',tagletSection:lpTag.tagletSection||null,autoStart:lpTag.autoStart!==!1,ovr:lpTag.ovr||{domain: 'lptag-a.liveperson.net', tagjs: 'tags-a.liveperson.net'},_v:'1.10.0',_tagCount:1,protocol:'https:',events:{bind:function(t,e,i){lpTag.defer(function(){lpTag.events.bind(t,e,i)},0)},trigger:function(t,e,i){lpTag.defer(function(){lpTag.events.trigger(t,e,i)},1)}},defer:function(t,e){0===e?(this._defB=this._defB||[],this._defB.push(t)):1===e?(this._defT=this._defT||[],this._defT.push(t)):(this._defL=this._defL||[],this._defL.push(t))},load:function(t,e,i){var n=this;setTimeout(function(){n._load(t,e,i)},0)},_load:function(t,e,i){var n=t;t||(n=this.protocol+'//'+(this.ovr&&this.ovr.domain?this.ovr.domain:'lptag.liveperson.net')+'/tag/tag.js?site='+this.site);var o=document.createElement('script');o.setAttribute('charset',e?e:'UTF-8'),i&&o.setAttribute('id',i),o.setAttribute('src',n),document.getElementsByTagName('head').item(0).appendChild(o)},init:function(){this._timing=this._timing||{},this._timing.start=(new Date).getTime();var t=this;window.attachEvent?window.attachEvent('onload',function(){t._domReady('domReady')}):(window.addEventListener('DOMContentLoaded',function(){t._domReady('contReady')},!1),window.addEventListener('load',function(){t._domReady('domReady')},!1)),'undefined'===typeof window._lptStop&&this.load()},start:function(){this.autoStart=!0},_domReady:function(t){this.isDom||(this.isDom=!0,this.events.trigger('LPT','DOM_READY',{t:t})),this._timing[t]=(new Date).getTime()},vars:lpTag.vars||[],dbs:lpTag.dbs||[],ctn:lpTag.ctn||[],sdes:lpTag.sdes||[],hooks:lpTag.hooks||[],identities:lpTag.identities||[],ev:lpTag.ev||[]},lpTag.init()):window.lpTag._tagCount+=1;</script>

<!-- END LivePerson Monitor. --> 

<!-- BEGIN function --> 

<script type="text/javascript">
window.lpDevAssist = window.lpDevAssist || {};
window.lpDevAssist.sendFeedbackSimple = function (answer) {
  var r = new XMLHttpRequest(); 
  r.open("POST", "https://c31ttcqad0.execute-api.us-east-2.amazonaws.com/alpha/helpful", true);
  r.setRequestHeader('Content-Type', 'application/json'); 
  r.setRequestHeader('Accept', 'application/json'); 
  r.onreadystatechange = function () { 
    if (r.status != 200) {
      console.log("Failure: " + r); 
      return; 
    }
    console.log("Success: " + r.responseText); 
  };
  var data = JSON.stringify({"feedback":lpDevAssist,"item":window.location});
  r.send(data);  
}
</script>

<!-- END isHelpful function --> 

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
                <a href="#" data-language-name="java">java</a>
          </div>
      </div>
    </div>
  </body>
</html>
